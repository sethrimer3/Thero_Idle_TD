<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thero Idle</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600&family=Great+Vibes&family=Space+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assets/styles.css" />
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            ['\\(', '\\)'],
            ['$', '$'],
          ],
          displayMath: [
            ['\\[', '\\]'],
          ],
          packages: { '[+]': ['color', 'html'] },
        },
        options: {
          renderActions: {
            addMenu: [],
          },
        },
      };
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </head>
  <body>
    <div class="startup-overlay" id="startup-overlay" role="status" aria-live="polite">
      <div class="startup-overlay__build" data-startup-build aria-label="Build number">Build —</div>
      <div class="startup-overlay__content" role="presentation">
        <!-- Allow the logo animation to run even when low graphics mode disables other animations. -->
        <img
          class="startup-overlay__logo"
          src="./assets/sprites/gravy_thyme_logo.png"
          alt="Thero Idle sigil"
          data-startup-logo
          data-allow-animation
        />
        <!-- Keep the loading glyph animated on mobile by opting it into animations explicitly. -->
        <div
          class="startup-overlay__loading"
          data-startup-loading
          role="img"
          aria-label="Loading glyph animation"
          data-allow-animation
        ></div>
        <p class="startup-overlay__hint">Calibrating glyph lattice…</p>
      </div>
    </div>
    <div
      class="offline-overlay"
      id="offline-overlay"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      tabindex="-1"
      hidden
    >
      <div class="offline-overlay__content">
        <p class="offline-overlay__title" id="offline-overlay-title">While asleep…</p>
        <div class="offline-overlay__equation-group" aria-live="polite">
          <div class="offline-overlay__equation-row" id="offline-aleph-row" aria-label="Aleph idle gains">
            <span class="offline-overlay__label offline-overlay__label--placeholder" aria-hidden="true"></span>
            <div class="offline-overlay__equation">
              <span class="offline-symbol">×</span>
              <span class="offline-number" id="offline-aleph-multiplier">0</span>
              <span class="offline-symbol">=</span>
              <span class="offline-number" id="offline-aleph-total">0</span>
              <span class="offline-symbol offline-symbol--glyph" aria-hidden="true">ℵ</span>
              <span class="offline-symbol">−</span>
              <span class="offline-resource__label">Motes</span>
            </div>
          </div>
          <div class="offline-overlay__equation-row" id="offline-bet-row" aria-label="Bet idle gains">
            <span class="offline-overlay__label offline-overlay__label--placeholder" aria-hidden="true"></span>
            <div class="offline-overlay__equation">
              <span class="offline-symbol">×</span>
              <span class="offline-number" id="offline-bet-multiplier">0</span>
              <span class="offline-symbol">=</span>
              <span class="offline-number" id="offline-bet-total">0</span>
              <span class="offline-symbol offline-symbol--glyph" aria-hidden="true">בּ</span>
              <span class="offline-symbol">−</span>
              <span class="offline-resource__label">Serendipity</span>
            </div>
          </div>
          <div class="offline-overlay__equation-row offline-overlay__equation-row--continuation" id="offline-happiness-row" aria-label="Bet happiness idle gains">
            <span class="offline-overlay__label offline-overlay__label--placeholder" aria-hidden="true"></span>
            <div class="offline-overlay__equation offline-overlay__equation--continuation">
              <span class="offline-symbol">×</span>
              <span class="offline-number" id="offline-happiness-multiplier">0</span>
              <span class="offline-symbol">=</span>
              <span class="offline-number" id="offline-happiness-total">0</span>
              <span class="offline-symbol offline-symbol--glyph" aria-hidden="true">בּ</span>
              <span class="offline-symbol">−</span>
              <span class="offline-resource__label">Happiness</span>
            </div>
          </div>
          <div class="offline-overlay__equation-row" id="offline-lamed-row" aria-label="Lamed idle gains">
            <span class="offline-overlay__label offline-overlay__label--placeholder" aria-hidden="true"></span>
            <div class="offline-overlay__equation">
              <span class="offline-symbol">×</span>
              <span class="offline-number" id="offline-lamed-multiplier">0</span>
              <span class="offline-symbol">=</span>
              <span class="offline-number" id="offline-lamed-total">0</span>
              <span class="offline-symbol offline-symbol--glyph" aria-hidden="true">ל</span>
              <span class="offline-symbol">−</span>
              <span class="offline-resource__label">Sparks</span>
            </div>
          </div>
          <div class="offline-overlay__equation-row" id="offline-tsadi-row" aria-label="Tsadi idle gains">
            <span class="offline-overlay__label offline-overlay__label--placeholder" aria-hidden="true"></span>
            <div class="offline-overlay__equation">
              <span class="offline-symbol">×</span>
              <span class="offline-number" id="offline-tsadi-multiplier">0</span>
              <span class="offline-symbol">=</span>
              <span class="offline-number" id="offline-tsadi-total">0</span>
              <span class="offline-symbol offline-symbol--glyph" aria-hidden="true">צ</span>
              <span class="offline-symbol">−</span>
              <span class="offline-resource__label">Particles</span>
            </div>
          </div>
          <div
            class="offline-overlay__equation-row offline-overlay__equation-row--continuation"
            id="offline-waals-row"
            aria-label="Waals idle gains"
          >
            <span class="offline-overlay__label offline-overlay__label--placeholder" aria-hidden="true"></span>
            <div class="offline-overlay__equation offline-overlay__equation--continuation">
              <span class="offline-symbol">×</span>
              <span class="offline-number" id="offline-waals-multiplier">0</span>
              <span class="offline-symbol">=</span>
              <span class="offline-number" id="offline-waals-total">0</span>
              <span class="offline-symbol offline-symbol--glyph" aria-hidden="true">צ</span>
              <span class="offline-symbol">−</span>
              <span class="offline-resource__label">Waals</span>
            </div>
          </div>
          <div class="offline-overlay__equation-row" id="offline-shin-row" aria-label="Shin idle gains">
            <span class="offline-overlay__label offline-overlay__label--placeholder" aria-hidden="true"></span>
            <div class="offline-overlay__equation">
              <span class="offline-symbol">×</span>
              <span class="offline-number" id="offline-shin-multiplier">0</span>
              <span class="offline-symbol">=</span>
              <span class="offline-number" id="offline-shin-total">0</span>
              <span class="offline-symbol offline-symbol--glyph" aria-hidden="true">ש</span>
              <span class="offline-symbol">−</span>
              <span class="offline-resource__label">Equivalence</span>
            </div>
          </div>
          <div class="offline-overlay__equation-row" id="offline-kuf-row" aria-label="Kuf idle gains">
            <span class="offline-overlay__label offline-overlay__label--placeholder" aria-hidden="true"></span>
            <div class="offline-overlay__equation">
              <span class="offline-symbol">×</span>
              <span class="offline-number" id="offline-kuf-multiplier">0</span>
              <span class="offline-symbol">=</span>
              <span class="offline-number" id="offline-kuf-total">0</span>
              <span class="offline-symbol offline-symbol--glyph" aria-hidden="true">ק</span>
              <span class="offline-symbol">−</span>
              <span class="offline-resource__label">Glyphs</span>
            </div>
          </div>
        </div>
        <p class="offline-overlay__prompt" id="offline-prompt" aria-live="polite">
          <em>Press anywhere to continue.</em>
        </p>
      </div>
    </div>
    <div
      class="level-story-overlay"
      id="level-story-overlay"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      tabindex="-1"
    >
      <div class="level-story-overlay__content" role="presentation">
        <p class="level-story-overlay__level" id="level-story-label">Level · Title</p>
        <div class="level-story-overlay__sections" id="level-story-sections"></div>
        <p class="level-story-overlay__prompt" id="level-story-prompt">
          
        </p>
      </div>
    </div>
    <div class="app-shell">
      <!-- FPS counter displayed in the top-left corner regardless of active tab. -->
      <div class="fps-counter" id="fps-counter" hidden aria-hidden="true" aria-label="Frames per second">--</div>
      <main class="main-stage">
        <section
          class="panel active"
          data-panel="tower"
          id="panel-tower"
          role="tabpanel"
          aria-labelledby="tab-tower"
        >
          <section class="playfield-wrapper" id="playfield-wrapper" aria-live="polite">
            <div class="playfield-shell">
              <div
                class="playfield"
                id="playfield"
                role="img"
                aria-label="Interactive glyph defense lane"
              >
                <!-- Playfield menu surfaces layout toggles when a level is active. -->
                <!-- Fullscreen toggle sits beside the playfield menu for quick access. -->
                <button
                  class="playfield-menu-button playfield-fullscreen-button"
                  type="button"
                  id="playfield-fullscreen-button"
                  aria-label="Enter full screen"
                  title="Enter full screen"
                >
                  ⤢
                </button>
                <button
                  class="playfield-menu-button"
                  type="button"
                  id="playfield-menu-button"
                  aria-label="Open playfield menu"
                  aria-controls="playfield-menu-panel"
                  aria-expanded="false"
                >
                  ☰
                </button>
                <div class="playfield-menu-panel" id="playfield-menu-panel" role="menu" hidden>
                  <!-- Replicate the stage control commence trigger within the quick menu. -->
                  <button
                    class="playfield-menu-item"
                    type="button"
                    id="playfield-menu-commence"
                    role="menuitem"
                  >
                    Commence Wave
                  </button>
                  <button
                    class="playfield-menu-item"
                    type="button"
                    id="playfield-menu-level-select"
                    role="menuitem"
                  >
                    Level Selection
                  </button>
                  <button
                    class="playfield-menu-item"
                    type="button"
                    id="playfield-menu-retry-wave"
                    role="menuitem"
                  >
                    Retry Wave
                  </button>
                  <button
                    class="playfield-menu-item"
                    type="button"
                    id="playfield-menu-dev-tools"
                    role="menuitem"
                  >
                    Dev Map Tools
                  </button>
                  <button
                    class="playfield-menu-item"
                    type="button"
                    id="playfield-speed"
                    role="menuitem"
                  >
                    Speed ×1
                  </button>
                  <button
                    class="playfield-menu-item"
                    type="button"
                    id="playfield-auto"
                    role="menuitem"
                  >
                    Loadout Placement
                  </button>
                  <button
                    class="playfield-menu-item"
                    type="button"
                    id="playfield-menu-stats"
                    role="menuitem"
                    aria-pressed="false"
                  >
                    Show Combat Stats
                  </button>
                  <label class="playfield-menu-toggle" for="playfield-auto-wave">
                    <input type="checkbox" id="playfield-auto-wave" checked />
                    <span>Auto-send next wave</span>
                  </label>
                </div>
                <canvas id="playfield-canvas" width="560" height="360"></canvas>
                <!-- Outcome overlay dims the battlefield and surfaces victory or defeat messaging. -->
                <div
                  class="playfield-outcome"
                  id="playfield-outcome"
                  role="dialog"
                  aria-modal="true"
                  aria-hidden="true"
                  tabindex="-1"
                  hidden
                >
                  <div class="playfield-outcome__panel">
                    <p class="playfield-outcome__title" id="playfield-outcome-title"></p>
                    <p class="playfield-outcome__subtitle" id="playfield-outcome-subtitle"></p>
                    <div class="playfield-outcome__actions">
                      <button
                        class="playfield-outcome__button"
                        type="button"
                        id="playfield-outcome-primary"
                      >
                        Back to Level Selection
                      </button>
                      <button
                        class="playfield-outcome__button playfield-outcome__button--secondary"
                        type="button"
                        id="playfield-outcome-secondary"
                        hidden
                      ></button>
                    </div>
                  </div>
                </div>
                <dl class="playfield-stats" aria-live="polite">
                  <div class="playfield-stats__item">
                    <dt>Wave</dt>
                    <dd id="playfield-wave">—</dd>
                  </div>
                  <div class="playfield-stats__item">
                    <dt>Gate</dt>
                    <dd id="playfield-health">—</dd>
                  </div>
                  <div class="playfield-stats__item">
                    <dt>Thero</dt>
                    <dd id="playfield-energy">—</dd>
                  </div>
                </dl>
                <div class="tower-loadout-shell" id="tower-loadout-shell" data-toggle-side="left">
                  <button
                    class="tower-loadout-toggle"
                    id="tower-loadout-toggle"
                    type="button"
                    aria-expanded="true"
                    aria-controls="tower-loadout-grid"
                    aria-label="Hide tower loadout"
                  >
                    <span class="tower-loadout-toggle__icon" aria-hidden="true">▼</span>
                  </button>
                  <div class="tower-loadout" id="tower-loadout" aria-label="Tower loadout" role="region">
                    <p class="tower-loadout-note screen-reader-only" id="tower-loadout-note">
                      Select four towers to bring into the defense. Drag the glyph chips onto the plane to
                      lattice them; drop a chip atop a matching tower to merge into the next tier.
                    </p>
                    <div class="tower-loadout-grid" id="tower-loadout-grid" role="list"></div>
                  </div>
                </div>
              </div>
              <!-- Playfield Visual Settings - Only visible when in a level -->
              <div class="playfield-settings-wrapper" id="playfield-settings-wrapper" hidden aria-hidden="true">
                <button
                  class="action-button playfield-settings-trigger"
                  type="button"
                  id="playfield-settings-toggle"
                  aria-expanded="false"
                  aria-controls="playfield-settings-menu"
                >
                  <span class="playfield-settings-trigger__icon" aria-hidden="true">℘</span>
                  <span class="playfield-settings-trigger__label">Settings</span>
                </button>
                <div
                  class="playfield-settings-menu"
                  id="playfield-settings-menu"
                  data-open="false"
                  aria-hidden="true"
                  hidden
                >
                  <div class="settings-toggle" id="playfield-enemy-particles-toggle-row">
                    <div class="settings-toggle-text">
                      <span class="settings-toggle-title" id="playfield-enemy-particles-title">Enemy Particles</span>
                      <span
                        class="settings-toggle-description"
                        id="playfield-enemy-particles-description"
                        >Particle effects around enemies for enhanced visual feedback.</span
                      >
                    </div>
                    <label class="settings-toggle-control" for="playfield-enemy-particles-toggle">
                      <input
                        type="checkbox"
                        id="playfield-enemy-particles-toggle"
                        class="settings-toggle-input"
                        role="switch"
                        aria-labelledby="playfield-enemy-particles-title"
                        aria-describedby="playfield-enemy-particles-description"
                        aria-checked="true"
                        checked
                      />
                      <span class="settings-toggle-slider" aria-hidden="true"></span>
                      <span class="settings-toggle-state" id="playfield-enemy-particles-state">On</span>
                    </label>
                  </div>
                  <button class="action-button ghost" type="button" id="playfield-track-type-button">
                    Track Type · Gradient
                  </button>
                  <button class="action-button ghost" type="button" id="tower-loadout-toggle-side-button">
                    Tower Toggle · Left
                  </button>
                  <button class="action-button ghost playfield-settings-close" type="button">Close</button>
                </div>
              </div>
              <!-- Combat stats panel sits below the battlefield so gameplay remains interactive. -->
              <div class="playfield-combat-stats-container">
                <section
                  class="playfield-combat-stats"
                  id="playfield-combat-stats"
                  role="region"
                  aria-label="Combat stats"
                  hidden
                  aria-hidden="true"
                >
                  <header class="playfield-combat-stats__header">Battle Analytics</header>
                  <section
                    class="playfield-combat-stats__section"
                    aria-labelledby="playfield-combat-stats-current-title"
                  >
                    <h3
                      class="playfield-combat-stats__section-title"
                      id="playfield-combat-stats-current-title"
                    >
                      Current Wave
                    </h3>
                    <p
                      class="playfield-combat-stats__note"
                      id="playfield-combat-stats-current-empty"
                    >
                      Current wave details will appear once defenses commence.
                    </p>
                    <div
                      class="playfield-combat-stats__wave"
                      id="playfield-combat-stats-current-wave"
                      role="list"
                      aria-live="polite"
                    ></div>
                  </section>
                  <section
                    class="playfield-combat-stats__section"
                    aria-labelledby="playfield-combat-stats-next-title"
                  >
                    <h3
                      class="playfield-combat-stats__section-title"
                      id="playfield-combat-stats-next-title"
                    >
                      Next Wave
                    </h3>
                    <p
                      class="playfield-combat-stats__note"
                      id="playfield-combat-stats-next-empty"
                    >
                      Future wave information appears after the current wave has been scouted.
                    </p>
                    <div
                      class="playfield-combat-stats__wave"
                      id="playfield-combat-stats-next-wave"
                      role="list"
                      aria-live="polite"
                    ></div>
                  </section>
                  <section
                    class="playfield-combat-stats__section"
                    aria-labelledby="playfield-combat-stats-active-title"
                  >
                    <h3
                      class="playfield-combat-stats__section-title"
                      id="playfield-combat-stats-active-title"
                    >
                      On-Screen Enemies
                    </h3>
                    <p
                      class="playfield-combat-stats__note"
                      id="playfield-combat-stats-active-empty"
                    >
                      Enemies currently traversing the lattice will appear here.
                    </p>
                    <div
                      class="playfield-combat-stats__active"
                      id="playfield-combat-stats-active-enemies"
                      role="list"
                      aria-live="polite"
                    ></div>
                  </section>
                  <section class="playfield-combat-stats__section" aria-labelledby="playfield-combat-stats-tower-title">
                    <h3 class="playfield-combat-stats__section-title" id="playfield-combat-stats-tower-title">
                      Tower Output
                    </h3>
                    <p class="playfield-combat-stats__note" id="playfield-combat-stats-tower-empty">
                      Tower damage summaries appear once combat begins.
                    </p>
                    <div
                      class="playfield-combat-stats__list"
                      id="playfield-combat-stats-towers"
                      role="list"
                      aria-live="polite"
                    ></div>
                  </section>
                  <section class="playfield-combat-stats__section" aria-labelledby="playfield-combat-stats-log-title">
                    <h3 class="playfield-combat-stats__section-title" id="playfield-combat-stats-log-title">
                      Attack Log
                    </h3>
                    <p class="playfield-combat-stats__note" id="playfield-combat-stats-log-empty">
                      Recent attack summaries will gather here.
                    </p>
                    <div
                      class="playfield-combat-stats__log"
                      id="playfield-combat-stats-log"
                      role="list"
                      aria-live="polite"
                    ></div>
                  </section>
                  <section class="playfield-combat-stats__section" aria-labelledby="playfield-combat-stats-enemy-title">
                    <h3 class="playfield-combat-stats__section-title" id="playfield-combat-stats-enemy-title">
                      Enemy History
                    </h3>
                    <p class="playfield-combat-stats__note" id="playfield-combat-stats-enemy-empty">
                      Defeated enemies and their top damaging towers will appear once battles resolve.
                    </p>
                    <div
                      class="playfield-combat-stats__enemies"
                      id="playfield-combat-stats-enemies"
                      role="list"
                      aria-live="polite"
                    ></div>
                  </section>
                </section>
                <div
                  class="playfield-combat-stats__dialog"
                  id="playfield-combat-stats-dialog"
                  role="dialog"
                  aria-modal="false"
                  hidden
                  aria-hidden="true"
                >
                  <div class="playfield-combat-stats__dialog-content">
                    <div class="playfield-combat-stats__dialog-header">
                      <h4
                        class="playfield-combat-stats__dialog-title"
                        id="playfield-combat-stats-dialog-title"
                      >
                        Enemy Details
                      </h4>
                      <button
                        class="playfield-combat-stats__dialog-close"
                        type="button"
                        id="playfield-combat-stats-dialog-close"
                        aria-label="Close enemy details"
                      >
                        ×
                      </button>
                    </div>
                    <dl
                      class="playfield-combat-stats__dialog-list"
                      id="playfield-combat-stats-dialog-list"
                    ></dl>
                  </div>
                </div>
              </div>
              <section
                class="overlay-editor"
                id="overlay-level-editor"
                hidden
                aria-hidden="true"
                role="region"
                aria-labelledby="level-editor-title"
              >
                <header class="overlay-editor__header">
                  <h3 class="overlay-editor__title" id="level-editor-title">Level Editor</h3>
                  <button
                    class="overlay-editor__toggle"
                    type="button"
                    id="level-editor-toggle"
                    aria-pressed="false"
                  >
                    Enable Editing
                  </button>
                </header>
                <p class="overlay-editor__note" id="level-editor-note">
                  Click the battlefield to place anchors. Drag markers to adjust, or Shift-click to remove the nearest anchor.
                  <span class="overlay-editor__count" id="level-editor-count">0 points</span>
                </p>
                <div class="overlay-editor__speed-controls">
                  <label class="overlay-editor__tool-option-label">
                    <span>Map Speed Multiplier</span>
                    <input
                      type="number"
                      class="overlay-editor__tool-input"
                      id="map-speed-multiplier-input"
                      value="1"
                      min="0.1"
                      max="10"
                      step="0.1"
                      title="Global speed multiplier for all enemies on this map"
                    />
                  </label>
                  <label class="overlay-editor__tool-option-label">
                    <span>Point Speed Multiplier</span>
                    <input
                      type="number"
                      class="overlay-editor__tool-input"
                      id="point-speed-multiplier-input"
                      value="1"
                      min="0.1"
                      max="10"
                      step="0.1"
                      disabled
                      title="Speed multiplier for the selected path point"
                    />
                  </label>
                  <button 
                    class="overlay-editor__button" 
                    type="button" 
                    id="apply-point-speed-button"
                    disabled
                    title="Apply the speed multiplier to the selected point"
                  >
                    Apply to Point
                  </button>
                </div>
                <div class="overlay-editor__actions">
                  <button class="overlay-editor__button" type="button" id="level-editor-clear" disabled>
                    Clear All
                  </button>
                  <button class="overlay-editor__button" type="button" id="level-editor-reset" disabled>
                    Reset to Level Path
                  </button>
                  <button class="overlay-editor__button" type="button" id="level-editor-export" disabled>
                    Copy Path JSON
                  </button>
                </div>
                <!-- Developer map tools palette for selecting placement modes -->
                <div class="overlay-editor__elements" id="developer-map-elements" hidden aria-hidden="true">
                  <p class="overlay-editor__elements-title">Map Tools Palette</p>
                  <div class="overlay-editor__palette">
                    <button
                      class="overlay-editor__palette-tool"
                      type="button"
                      id="palette-tool-path"
                      data-tool="path"
                      aria-pressed="true"
                      title="Edit path anchors"
                    >
                      <span class="overlay-editor__palette-icon">⚓</span>
                      <span class="overlay-editor__palette-label">Path</span>
                    </button>
                    <button
                      class="overlay-editor__palette-tool"
                      type="button"
                      id="palette-tool-crystal"
                      data-tool="crystal"
                      aria-pressed="false"
                      title="Place crystal obstacles"
                    >
                      <span class="overlay-editor__palette-icon">◇</span>
                      <span class="overlay-editor__palette-label">Crystal</span>
                    </button>
                    <button
                      class="overlay-editor__palette-tool"
                      type="button"
                      id="palette-tool-tower"
                      data-tool="tower"
                      aria-pressed="false"
                      title="Place pre-configured towers"
                    >
                      <span class="overlay-editor__palette-icon">⬡</span>
                      <span class="overlay-editor__palette-label">Tower</span>
                    </button>
                    <button
                      class="overlay-editor__palette-tool"
                      type="button"
                      id="palette-tool-erase"
                      data-tool="erase"
                      aria-pressed="false"
                      title="Remove map elements"
                    >
                      <span class="overlay-editor__palette-icon">✕</span>
                      <span class="overlay-editor__palette-label">Erase</span>
                    </button>
                  </div>
                  <div class="overlay-editor__tool-options" id="tool-options-container">
                    <!-- Crystal options -->
                    <div class="overlay-editor__tool-option-group" id="tool-options-crystal" hidden>
                      <label class="overlay-editor__tool-option-label">
                        <span>Crystal Integrity</span>
                        <input
                          type="number"
                          class="overlay-editor__tool-input"
                          id="crystal-integrity-input"
                          value="900"
                          min="10"
                          max="100000"
                          step="10"
                        />
                      </label>
                      <label class="overlay-editor__tool-option-label">
                        <span>Thero Reward</span>
                        <input
                          type="number"
                          class="overlay-editor__tool-input"
                          id="crystal-thero-input"
                          value="0"
                          min="0"
                          max="1000000"
                          step="10"
                        />
                      </label>
                    </div>
                    <!-- Tower options -->
                    <div class="overlay-editor__tool-option-group" id="tool-options-tower" hidden>
                      <label class="overlay-editor__tool-option-label">
                        <span>Tower Type</span>
                        <select class="overlay-editor__tool-select" id="tower-type-select">
                          <option value="alpha">α - Alpha (Basic)</option>
                          <option value="beta">β - Beta (Multiplier)</option>
                          <option value="gamma">γ - Gamma (Exponent)</option>
                          <option value="delta">δ - Delta (Command)</option>
                          <option value="epsilon">ε - Epsilon (Factorial)</option>
                        </select>
                      </label>
                    </div>
                  </div>
                  <div class="overlay-editor__elements-actions">
                    <button class="overlay-editor__button" type="button" id="developer-clear-crystals">
                      Clear All Crystals
                    </button>
                    <button class="overlay-editor__button" type="button" id="developer-clear-towers" hidden>
                      Clear All Towers
                    </button>
                  </div>
                  <p class="overlay-editor__elements-note" id="developer-map-elements-note" hidden></p>
                </div>
                <textarea
                  class="overlay-editor__output"
                  id="level-editor-output"
                  rows="6"
                  readonly
                  placeholder="Enable editing to chart a new path."
                ></textarea>
                <p class="overlay-editor__status" id="level-editor-status" role="status" aria-live="polite" hidden></p>
                <!-- Wave editor for configuring enemy waves in developer mode -->
                <section class="overlay-editor__wave-editor" id="wave-editor-section" hidden aria-hidden="true">
                  <h4 class="overlay-editor__subtitle">Wave Configuration</h4>
                  <div class="overlay-editor__wave-controls">
                    <button class="overlay-editor__button" type="button" id="wave-editor-add-wave">
                      Add Wave
                    </button>
                    <button class="overlay-editor__button" type="button" id="wave-editor-clear">
                      Clear All Waves
                    </button>
                  </div>
                  <div class="overlay-editor__wave-list" id="wave-editor-list" aria-live="polite">
                    <!-- Wave items populated dynamically -->
                  </div>
                  <div class="overlay-editor__wave-export">
                    <button class="overlay-editor__button overlay-editor__button--primary" type="button" id="wave-editor-export">
                      Export Compact Wave String
                    </button>
                    <button class="overlay-editor__button" type="button" id="wave-editor-import">
                      Import Wave String
                    </button>
                  </div>
                  <textarea
                    class="overlay-editor__output"
                    id="wave-editor-output"
                    rows="3"
                    readonly
                    placeholder="Compact wave string will appear here..."
                  ></textarea>
                </section>
              </section>
            </div>
          </section>
          <section class="level-section" id="level-selection">
            <!-- Leaderboard shortcut anchored in the upper corner of the Defense tab. -->
            <button
              class="defense-leaderboard-button"
              type="button"
              id="defense-leaderboard-button"
              aria-label="View defense leaderboards"
            >
              <span aria-hidden="true">⚔</span>
            </button>
            <header class="subsection-title subsection-title--level">Project: Thero</header>
            <div class="level-grid" id="level-grid" aria-live="polite"></div>
            <!-- Surface the live thero multiplier and starting equation beneath the level list. -->
            <div class="level-thero-banner" id="level-thero-banner" aria-live="polite">
              <div class="level-thero-row">
                <span class="level-thero-label">Thero Multiplier</span>
                <span class="level-thero-value" id="level-thero-multiplier">×0.00</span>
              </div>
            </div>
            <!-- Cognitive Realm: Collective Unconscious - unlocked at level set 3 -->
            <section class="cognitive-realm-section" id="cognitive-realm-section" hidden aria-hidden="true">
              <header class="subsection-title subsection-title--cognitive-realm">
                Collective Unconscious
              </header>
              <p class="cognitive-realm-hint">Tap nodes to learn about archetypes • Pan to explore • Zoom with scroll or pinch</p>
              <div class="cognitive-realm-container" id="cognitive-realm-container">
                <canvas class="cognitive-realm-canvas" id="cognitive-realm-canvas" aria-label="Interactive collective unconscious archetype map"></canvas>
              </div>
              <!-- Territory statistics displayed below the map -->
              <div class="cognitive-realm-stats">
                <div class="cognitive-realm-stat">
                  <span class="cognitive-realm-stat-label cognitive-realm-stat-label--player">Player:</span>
                  <span class="cognitive-realm-stat-value" id="cognitive-realm-stat-player">0</span>
                </div>
                <div class="cognitive-realm-stat">
                  <span class="cognitive-realm-stat-label cognitive-realm-stat-label--enemy">Enemy:</span>
                  <span class="cognitive-realm-stat-value" id="cognitive-realm-stat-enemy">0</span>
                </div>
                <div class="cognitive-realm-stat">
                  <span class="cognitive-realm-stat-label cognitive-realm-stat-label--neutral">Neutral:</span>
                  <span class="cognitive-realm-stat-value" id="cognitive-realm-stat-neutral">0</span>
                </div>
              </div>
              <!-- Graphical options button at bottom (like spire options) -->
              <div class="cognitive-realm-options-wrapper">
                <button
                  class="action-button cognitive-realm-options-trigger"
                  type="button"
                  id="cognitive-realm-options-toggle"
                  aria-expanded="false"
                  aria-controls="cognitive-realm-options-menu"
                >
                  <span>Visual Options</span>
                </button>
                <div
                  class="spire-options-menu"
                  id="cognitive-realm-options-menu"
                  data-open="false"
                  aria-hidden="true"
                  hidden
                >
                  <div class="settings-toggle" id="cognitive-realm-neuron-connections-toggle-row">
                    <div class="settings-toggle-text">
                      <span class="settings-toggle-title" id="cognitive-realm-neuron-connections-title">Neuron Connections</span>
                      <span class="settings-toggle-description" id="cognitive-realm-neuron-connections-description"
                        >Soft-body rope connections between nodes with gradient opacity fade.</span
                      >
                    </div>
                    <label class="settings-toggle-control" for="cognitive-realm-neuron-connections-toggle">
                      <input
                        type="checkbox"
                        id="cognitive-realm-neuron-connections-toggle"
                        class="settings-toggle-input"
                        role="switch"
                        aria-checked="true"
                        checked
                      />
                      <span class="settings-toggle-thumb"></span>
                      <span class="settings-toggle-state" id="cognitive-realm-neuron-connections-state">On</span>
                    </label>
                  </div>
                  <div class="settings-toggle" id="cognitive-realm-neuron-pulses-toggle-row">
                    <div class="settings-toggle-text">
                      <span class="settings-toggle-title" id="cognitive-realm-neuron-pulses-title">Neuron Pulses</span>
                      <span class="settings-toggle-description" id="cognitive-realm-neuron-pulses-description"
                        >Orbital light sparks that animate around nodes.</span
                      >
                    </div>
                    <label class="settings-toggle-control" for="cognitive-realm-neuron-pulses-toggle">
                      <input
                        type="checkbox"
                        id="cognitive-realm-neuron-pulses-toggle"
                        class="settings-toggle-input"
                        role="switch"
                        aria-checked="true"
                        checked
                      />
                      <span class="settings-toggle-thumb"></span>
                      <span class="settings-toggle-state" id="cognitive-realm-neuron-pulses-state">On</span>
                    </label>
                  </div>
                  <div class="settings-toggle" id="cognitive-realm-ambient-particles-toggle-row">
                    <div class="settings-toggle-text">
                      <span class="settings-toggle-title" id="cognitive-realm-ambient-particles-title">Ambient Particles</span>
                      <span class="settings-toggle-description" id="cognitive-realm-ambient-particles-description"
                        >Floating light motes that drift across the background.</span
                      >
                    </div>
                    <label class="settings-toggle-control" for="cognitive-realm-ambient-particles-toggle">
                      <input
                        type="checkbox"
                        id="cognitive-realm-ambient-particles-toggle"
                        class="settings-toggle-input"
                        role="switch"
                        aria-checked="true"
                        checked
                      />
                      <span class="settings-toggle-thumb"></span>
                      <span class="settings-toggle-state" id="cognitive-realm-ambient-particles-state">On</span>
                    </label>
                  </div>
                  <div class="settings-toggle" id="cognitive-realm-node-drift-toggle-row">
                    <div class="settings-toggle-text">
                      <span class="settings-toggle-title" id="cognitive-realm-node-drift-title">Node Drift</span>
                      <span class="settings-toggle-description" id="cognitive-realm-node-drift-description"
                        >Gently move archetype nodes toward periodically shifting offsets.</span
                      >
                    </div>
                    <label class="settings-toggle-control" for="cognitive-realm-node-drift-toggle">
                      <input
                        type="checkbox"
                        id="cognitive-realm-node-drift-toggle"
                        class="settings-toggle-input"
                        role="switch"
                        aria-checked="false"
                      />
                      <span class="settings-toggle-thumb"></span>
                      <span class="settings-toggle-state" id="cognitive-realm-node-drift-state">Off</span>
                    </label>
                  </div>
                  <div class="settings-toggle" id="cognitive-realm-randomized-layout-toggle-row">
                    <div class="settings-toggle-text">
                      <span class="settings-toggle-title" id="cognitive-realm-randomized-layout-title">Randomized Layout</span>
                      <span class="settings-toggle-description" id="cognitive-realm-randomized-layout-description"
                        >Scatter nodes to unique starting positions each time the map is opened.</span
                      >
                    </div>
                  <label class="settings-toggle-control" for="cognitive-realm-randomized-layout-toggle">
                    <input
                      type="checkbox"
                        id="cognitive-realm-randomized-layout-toggle"
                        class="settings-toggle-input"
                        role="switch"
                        aria-checked="true"
                        checked
                      />
                      <span class="settings-toggle-thumb"></span>
                      <span class="settings-toggle-state" id="cognitive-realm-randomized-layout-state">On</span>
                    </label>
                  </div>
                  <button class="action-button ghost spire-options-close" type="button">Close</button>
                </div>
              </div>
            </section>
          </section>
          <!-- Developer mode toggle positioned at the very bottom of the Defense tab -->
          <div class="stage-developer-toggle-wrapper" id="stage-developer-toggle-wrapper">
            <label class="developer-mode-toggle stage-developer-mode-toggle" for="stage-developer-mode">
              <input type="checkbox" id="stage-developer-mode" />
              Developer Mode — unlock all towers, levels, and entries
            </label>
          </div>
        </section>

        <section
          class="panel"
          data-panel="towers"
          id="panel-towers"
          role="tabpanel"
          aria-labelledby="tab-towers"
          hidden
        >
          <!-- Present tower resource summaries near the top of the Towers tab. -->
          <div class="tower-glyph-summary" id="tower-glyph-summary" aria-live="polite">
            <!-- Arrange the first trio of glyph counters on a dedicated desktop row. -->
            <div class="tower-glyph-row tower-glyph-row--primary">
              <div class="tower-glyph-item">
                <span class="tower-glyph-label">Aleph Glyphs:</span>
                <span class="tower-glyph-value" id="tower-glyphs-aleph-total">0 ℵ</span>
                <span class="tower-glyph-unallocated" id="tower-glyphs-aleph-unused"></span>
              </div>
              <div class="tower-glyph-item">
                <span class="tower-glyph-label">Bet Glyphs:</span>
                <span class="tower-glyph-value" id="tower-glyphs-bet-total">0 בּ</span>
                <span class="tower-glyph-unallocated" id="tower-glyphs-bet-unused"></span>
              </div>
              <div class="tower-glyph-item">
                <span class="tower-glyph-label">Lamed Glyphs:</span>
                <span class="tower-glyph-value" id="tower-glyphs-lamed-total">0 ל</span>
                <span class="tower-glyph-unallocated" id="tower-glyphs-lamed-unused"></span>
              </div>
            </div>
            <!-- Position the higher-tier glyph counters beneath the introductory row. -->
            <div class="tower-glyph-row tower-glyph-row--secondary">
              <div class="tower-glyph-item">
                <span class="tower-glyph-label">Tsadi Glyphs:</span>
                <span class="tower-glyph-value" id="tower-glyphs-tsadi-total">0 צ</span>
                <span class="tower-glyph-unallocated" id="tower-glyphs-tsadi-unused"></span>
              </div>
              <div class="tower-glyph-item">
                <span class="tower-glyph-label">Shin Glyphs:</span>
                <span class="tower-glyph-value" id="tower-glyphs-shin-total">0 ש</span>
                <span class="tower-glyph-unallocated" id="tower-glyphs-shin-unused"></span>
              </div>
              <div class="tower-glyph-item">
                <span class="tower-glyph-label">Kuf Glyphs:</span>
                <span class="tower-glyph-value" id="tower-glyphs-kuf-total">0 ק</span>
                <span class="tower-glyph-unallocated" id="tower-glyphs-kuf-unused"></span>
              </div>
            </div>
          </div>
          <div class="tower-panel-controls" id="tower-panel-controls">
            <!-- Keep the utility buttons grouped on a single responsive row. -->
            <div class="tower-panel-controls__row tower-panel-controls__row--primary">
              <button
                class="tower-panel-button tower-panel-button--variables"
                type="button"
                id="tower-variable-library"
                aria-label="Open Variables"
                aria-haspopup="dialog"
                aria-controls="variable-library-overlay"
                aria-expanded="false"
              >
                <span class="tower-panel-button-icon" aria-hidden="true">Var</span>
                <span class="tower-panel-button-label">Variables</span>
              </button>
              <button
                class="tower-panel-button tower-panel-button--matrix"
                type="button"
                data-upgrade-matrix-trigger
                aria-label="Open Matrix"
                aria-haspopup="dialog"
                aria-controls="upgrade-matrix-overlay"
                aria-expanded="false"
              >
                <span class="tower-panel-button-icon" aria-hidden="true">⧉</span>
                <span class="tower-panel-button-label">Matrix</span>
              </button>
              <button
                class="tower-panel-button tower-tree-map-button"
                type="button"
                id="tower-tree-map-toggle"
                aria-label="Open Tree Map"
                aria-pressed="false"
                aria-expanded="false"
                aria-controls="tower-tree-map"
                title="Open the Tower Tree Map"
              >
                <span class="tower-tree-map-icon" aria-hidden="true">
                  <svg viewBox="0 0 80 80" focusable="false" aria-hidden="true">
                    <g stroke="currentColor" stroke-width="2" fill="none">
                      <path d="M18 18 L40 10 L62 18" />
                      <path d="M18 62 L40 70 L62 62" />
                      <path d="M18 18 L18 62" />
                      <path d="M62 18 L62 62" />
                      <path d="M40 10 L40 70" />
                    </g>
                    <g fill="currentColor" font-family="'Cormorant Garamond', serif" font-size="16" text-anchor="middle">
                      <circle cx="18" cy="18" r="8" fill="rgba(255,255,255,0.15)" />
                      <text x="18" y="22">α</text>
                      <circle cx="40" cy="10" r="8" fill="rgba(255,255,255,0.15)" />
                      <text x="40" y="14">β</text>
                      <circle cx="62" cy="18" r="8" fill="rgba(255,255,255,0.15)" />
                      <text x="62" y="22">γ</text>
                      <circle cx="18" cy="62" r="8" fill="rgba(255,255,255,0.15)" />
                      <text x="18" y="66">δ</text>
                      <circle cx="62" cy="62" r="8" fill="rgba(255,255,255,0.15)" />
                      <text x="62" y="66">ε</text>
                    </g>
                  </svg>
                </span>
                <span class="tower-tree-map-label tower-panel-button-label">Tree</span>
              </button>
              <button
                class="tower-panel-button tower-panel-button--equipment"
                type="button"
                id="tower-equipment-button"
                aria-label="Open Equipment"
                aria-haspopup="dialog"
                aria-controls="crafting-overlay"
                aria-expanded="false"
              >
                <span class="tower-panel-button-icon" aria-hidden="true">⚒</span>
                <span class="tower-panel-button-label">Equipment</span>
              </button>
            </div>
          </div>
          <div
            class="tower-tree-map"
            id="tower-tree-map"
            role="region"
            aria-label="Tower Tree Map"
            hidden
            aria-hidden="true"
          >
            <svg class="tower-tree-map-links" aria-hidden="true" focusable="false"></svg>
            <div class="tower-tree-map-nodes" data-tree-node-layer></div>
            <p class="tower-tree-map-note">Only discovered towers appear in this constellation.</p>
          </div>
          <div class="panel-grid" id="tower-card-grid">
            <article class="card card--mind-gate" data-tower-id="mind-gate" aria-hidden="false">
              <header class="tower-header">
                <span class="tower-tier">Tier 0</span>
                <h3>
                  <span class="mind-gate-symbol" aria-hidden="true">
                    <img src="assets/images/tower-mind-gate.svg" alt="" />
                  </span>
                  Mind Gate
                </h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \wp = \text{Life} \times \text{Regeneration} \)</p>
                <ul class="formula-definition">
                  <li>Life → \( 100^{\aleph_{1} / \aleph_{2}} \)</li>
                  <li>Regeneration → \( \frac{100 \times \aleph_{2}}{\aleph_{1}} \)</li>
                </ul>
              </div>
              <ul class="upgrade-list">
                <li>Fortify \(\aleph_{1}\) to amplify Life's exponential reservoir.</li>
                <li>Stabilize \(\aleph_{2}\) so Regeneration surges refill the gate between waves.</li>
              </ul>
              <footer class="card-footer">
                The original tower—anchoring the lane's finale. When the Mind Gate collapses, inspiration runs dry.
              </footer>
            </article>
            <article class="card" data-tower-id="alpha" aria-hidden="false">
              <header class="tower-header">
                <span class="tower-tier">Tier I</span>
                <h3>α alpha tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \alpha = \text{Atk} \times \text{Spd} \)</p>
                <ul class="formula-definition">
                  <li>Atk → projectile force braided from \(\aleph_{1}\)</li>
                  <li>Spd → oscillation cadence tuned by \(\aleph_{2}\)</li>
                </ul>
                <p class="formula-line result">\( \text{Atk} = 5 \times \aleph_{1} \)</p>
                <p class="formula-line result">\( \text{Spd} = 0.5 \times \aleph_{2} \)</p>
              </div>
              <ul class="upgrade-list">
                <li>Invest collected glyphs into \(\aleph_{1}\) to amplify Atk.</li>
                <li>Stabilize \(\aleph_{2}\) to quicken Spd and sustain tempo.</li>
              </ul>
              <footer class="card-footer">Shoots a focused glyph-bullet at the nearest foe.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="alpha">
                Equip α
              </button>
            </article>
            <article class="card" data-tower-id="beta" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier II</span>
                <h3>β beta tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \beta = \text{Atk} \times \text{Spd} \times \text{Rng} \)</p>
                <ul class="formula-definition">
                  <li>Atk → α's output amplified by \(\aleph_{1}\)</li>
                  <li>Spd → cadence accelerated by neighbouring α lattices</li>
                  <li>Rng → coverage stretched through linked α channels</li>
                </ul>
                <p class="formula-line result">\( \text{Atk} = \alpha \times \aleph_{1} \)</p>
              </div>
              <ul class="upgrade-list">
                <li>Sharpen \(\aleph_{1}\) investments to raise inherited α power.</li>
                <li>Stabilize linked α lattices to hold the beam's Spd steady.</li>
                <li>Stretch the lattice web to guide α farther downlane.</li>
              </ul>
              <footer class="card-footer">
                Emits a piercing beam amplified purely from α's output.
              </footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="beta">
                Equip β
              </button>
            </article>
            <article class="card" data-tower-id="gamma" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier III</span>
                <h3>γ gamma tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \gamma = \text{Atk} \times \text{Spd} \times \text{Rng} \times \text{Prc} \)</p>
                <ul class="formula-definition">
                  <li>Atk → β's surge braided with \(\aleph_{1}\)</li>
                  <li>Spd → cadence tuned by α lattice links</li>
                  <li>Rng → arc reach extended by β conductors</li>
                  <li>Prc → bolt depth anchored to \(\aleph_{2}\)</li>
                </ul>
                <p class="formula-line result">\( \text{Atk} = \beta \times \aleph_{1} \)</p>
                <p class="formula-line result">\( \text{Prc} = \aleph_{2} \)</p>
              </div>
              <ul class="upgrade-list">
                <li>Channel β's beam into branching lightning arcs.</li>
                <li>Stabilize β resonance to keep the bolts on target.</li>
              </ul>
              <footer class="card-footer">Distills β into a tempo-shifting conductor with homing bolts.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="gamma">
                Equip γ
              </button>
            </article>
            <article class="card" data-tower-id="delta" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier IV</span>
                <h3>δ delta tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \delta = \gamma \cdot \ln(\gamma + 1) \)</p>
                <ul class="formula-definition">
                  <li>γ → conductor strength inherited from the gamma lattice</li>
                  <li>Tot → total spectral soldiers δ can field concurrently</li>
                </ul>
                <p class="formula-line result">Commands spectral cohorts scaled purely by γ.</p>
              </div>
              <ul class="upgrade-list">
                <li>Empower γ-bound soldiers with slowing sigils</li>
                <li>Rally boosts: δ cohorts grant +γ% damage to nearby towers</li>
              </ul>
              <footer class="card-footer">Does not attack directly—commands spectral fighters to guard the lane.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="delta">
                Equip δ
              </button>
            </article>
            <article class="card" data-tower-id="epsilon" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier V</span>
                <h3>ε epsilon tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \varepsilon = \delta^{2} \)</p>
                <ul class="formula-definition">
                  <li>δ → command strength squared into burst charges</li>
                </ul>
                <p class="formula-line result">Squares δ's cohorts into rapid-fire needle storms.</p>
              </div>
              <ul class="upgrade-list">
                <li>Focus δ energy into tighter splash windows</li>
                <li>Store δ pulses to release simultaneous volleys</li>
              </ul>
              <footer class="card-footer">Squares δ's momentum into rapid glyph needles.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="epsilon">
                Equip ε
              </button>
            </article>
            <article class="card" data-tower-id="zeta" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier VI</span>
                <h3>ζ zeta tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \zeta = \sqrt{\varepsilon} \)</p>
                <ul class="formula-definition">
                  <li>ε → needle storm potential moderated into harmonic splash</li>
                </ul>
                <p class="formula-line result">Roots ε into controlled harmonic cascades.</p>
              </div>
              <ul class="upgrade-list">
                <li>Focus ε residue into denser splash pools</li>
                <li>Delay the release to stack ε charges before bursting</li>
              </ul>
              <footer class="card-footer">Turns ε's swell into rolling resonance detonations.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="zeta">
                Equip ζ
              </button>
            </article>
            <article class="card" data-tower-id="eta" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier VII</span>
                <h3>η eta tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \eta = \ln(\zeta + 1) \)</p>
                <ul class="formula-definition">
                  <li>ζ → harmonic cascades condensed through a logarithmic focus</li>
                </ul>
                <p class="formula-line result">Condenses ζ into an armor-slicing resonance veil.</p>
              </div>
              <ul class="upgrade-list">
                <li>Widen the ζ intake to stretch the resonance veil</li>
                <li>Share η's focused field with δ soldiers to shatter shields</li>
              </ul>
              <footer class="card-footer">Extends ζ's song into a logarithmic debuff that strips defenses.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="eta">
                Equip η
              </button>
            </article>
            <article class="card" data-tower-id="theta" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier VIII</span>
                <h3>θ theta tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \theta = \eta^{2} \)</p>
                <ul class="formula-definition">
                  <li>η → logarithmic veil squared into lane-warping force</li>
                </ul>
                <p class="formula-line result">Squares η to bend lanes and slow invaders.</p>
              </div>
              <ul class="upgrade-list">
                <li>Amplify η before squaring to thicken slow fields</li>
                <li>Modulate η pulses to reflect enemies along mirrored paths</li>
              </ul>
              <footer class="card-footer">Projects η's strength as modular fields that reshape the curve around your towers.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="theta">
                Equip θ
              </button>
            </article>
            <article class="card" data-tower-id="iota" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier IX</span>
                <h3>ι iota tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \iota = \sqrt{\theta} \)</p>
                <ul class="formula-definition">
                  <li>θ → squared lane warp relaxed back into circulating beams</li>
                </ul>
                <p class="formula-line result">Loops θ into circulating glyph lasers that ride the curve.</p>
              </div>
              <ul class="upgrade-list">
                <li>Stack additional loops to layer multiple θ-derived beams</li>
                <li>Collapse the loop to detonate when enemies cross the path</li>
              </ul>
              <footer class="card-footer">Sweeps circular beams around waypoints using relaxed θ energy.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="iota">
                Equip ι
              </button>
            </article>
            <article class="card" data-tower-id="kappa" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier X</span>
                <h3>κ kappa tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \kappa = \iota + \sin(\iota) \)</p>
                <ul class="formula-definition">
                  <li>ι → circulating beam intensity feeding the curvature</li>
                  <li>sin(ι) → oscillation that sharpens focused bursts</li>
                </ul>
                <p class="formula-line result">Bends ι's loops into oscillating kill zones.</p>
              </div>
              <ul class="upgrade-list">
                <li>Sharpen ι to intensify oscillating curvature strikes</li>
                <li>Diffuse the sine rhythm to grant allies range along curved lanes</li>
              </ul>
              <footer class="card-footer">Focuses on choke points by warping ι's rhythm around tight corners.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="kappa">
                Equip κ
              </button>
            </article>
            <article class="card" data-tower-id="lambda" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XI</span>
                <h3>λ lambda tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \lambda = \kappa \times N_{\text{eff}} \)</p>
                <ul class="formula-definition">
                  <li>κ → inherited tripwire power pulled straight from Kappa</li>
                  <li>N<sub>eff</sub> → live enemy count multiplied by Aleph₃ weighting</li>
                </ul>
                <p class="formula-line result">Fires a piercing beam whose damage, colour, and wavelength scale with battlefield density.</p>
              </div>
              <ul class="upgrade-list">
                <li>Aleph₁ extends the laser by +0.5 metres per glyph, reaching distant lanes.</li>
                <li>Aleph₂ accelerates the pulse, logarithmically approaching 0.5 shots each second.</li>
                <li>Aleph₃ multiplies each enemy’s contribution, tightening wavelengths and driving the rainbow sweep.</li>
              </ul>
              <footer class="card-footer">The beam ignores the monochrome palette, cycling the visible spectrum before dissolving into a brightening sine wave.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="lambda">
                Equip λ
              </button>
            </article>
            <article class="card" data-tower-id="mu" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XII</span>
                <h3>μ mu tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \mu = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="mu">
                Equip μ
              </button>
            </article>
            <article class="card" data-tower-id="nu" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XIII</span>
                <h3>ν nu tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \nu = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="nu">
                Equip ν
              </button>
            </article>
            <article class="card" data-tower-id="xi" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XIV</span>
                <h3>ξ xi tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \xi = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="xi">
                Equip ξ
              </button>
            </article>
            <article class="card" data-tower-id="omicron" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XV</span>
                <h3>ο omicron tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( ο = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="omicron">
                Equip ο
              </button>
            </article>
            <article class="card" data-tower-id="pi" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XVI</span>
                <h3>π pi tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \pi = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="pi">
                Equip π
              </button>
            </article>
            <article class="card" data-tower-id="rho" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XVII</span>
                <h3>ρ rho tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \rho = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="rho">
                Equip ρ
              </button>
            </article>
            <article class="card" data-tower-id="sigma" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XVIII</span>
                <h3>σ sigma tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \sigma = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="sigma">
                Equip σ
              </button>
            </article>
            <article class="card" data-tower-id="tau" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XIX</span>
                <h3>τ tau tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \tau = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="tau">
                Equip τ
              </button>
            </article>
            <article class="card" data-tower-id="upsilon" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XX</span>
                <h3>υ upsilon tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \upsilon = atk \times tot \times spd \)</p>
                <ul class="formula-definition">
                  <li>atk = micro-triangle laser power.</li>
                  <li>tot = hangar capacity (ships on field).</li>
                  <li>spd = ship fabrication per second.</li>
                </ul>
                <p class="formula-line result">Launches infinite-range micro-fighters that curve toward focus targets.</p>
              </div>
              <ul class="upgrade-list">
                <li>ℵ₁ raises ship laser attack.</li>
                <li>ℵ₂ accelerates ship production speed.</li>
                <li>ℵ₃ expands the maximum swarm size.</li>
                <li>ℵ₄ increases ship flight speed and turning radius.</li>
              </ul>
              <footer class="card-footer">
                Click any enemy to force υ to hunt it until it falls; otherwise prioritizes first/strongest/weakest.
              </footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="upsilon">
                Equip υ
              </button>
            </article>
            <article class="card" data-tower-id="phi" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XXI</span>
                <h3>φ phi tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \varphi = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="phi">
                Equip φ
              </button>
            </article>
            <article class="card" data-tower-id="chi" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XXII</span>
                <h3>χ chi tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \chi = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="chi">
                Equip χ
              </button>
            </article>
            <article class="card" data-tower-id="psi" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XXIII</span>
                <h3>ψ psi tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \psi = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="psi">
                Equip ψ
              </button>
            </article>
            <article class="card" data-tower-id="omega" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XXIV</span>
                <h3>Ω omega tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \Omega = X \)</p>
                <ul class="formula-definition">
                  <li>Not defined yet.</li>
                </ul>
                <p class="formula-line result">Not defined yet.</p>
              </div>
              <ul class="upgrade-list">
                <li>Not defined yet.</li>
              </ul>
              <footer class="card-footer">Not defined yet.</footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="omega">
                Equip Ω
              </button>
            </article>

            <article class="card" data-tower-id="infinity" hidden aria-hidden="true">
              <header class="tower-header">
                <span class="tower-tier">Tier XXV</span>
                <h3>∞ infinity tower</h3>
              </header>
              <div class="formula-block">
                <p class="formula-line">\( \infty = \text{Exp} \times \text{Rng} \)</p>
                <ul class="formula-definition">
                  <li>Exp → Natural logarithm of total tower count: \(\ln(n)\)</li>
                  <li>Rng → Aura radius: \(2e\) meters (Euler's number)</li>
                  <li>Mul → Exponential base for damage boost</li>
                </ul>
                <p class="formula-line result">\( \text{Exp} = \ln(n) \times \aleph_{1} \)</p>
                <p class="formula-line result">\( \text{Rng} = 2e + 0.5(\aleph_{2} - 1) \)</p>
                <p class="formula-line result">\( \text{Mul} = e + 0.1(\aleph_{3} - 1) \)</p>
              </div>
              <ul class="upgrade-list">
                <li>Upgrade \(\aleph_{1}\) to amplify the exponent bonus applied to nearby towers.</li>
                <li>Expand \(\aleph_{2}\) to extend the infinity aura radius.</li>
                <li>Enhance \(\aleph_{3}\) to increase the exponential damage multiplier base.</li>
              </ul>
              <footer class="card-footer">
                Provides exponential damage boost to all towers within range. 
                Bonus formula: \( \text{damage} \times \text{Mul}^{\text{Exp}} \).
                Golden lines connect infinity tower to affected towers.
              </footer>
              <button class="tower-equip-button" type="button" data-tower-toggle="infinity">
                Equip ∞
              </button>
            </article>

          </div>
          
          <!-- Developer mode toggle for tower card visibility -->
          <div class="tower-visibility-controls" id="tower-visibility-controls">
            <label class="tower-visibility-toggle" for="tower-visibility-developer-mode">
              <input type="checkbox" id="tower-visibility-developer-mode" />
              <span class="tower-visibility-label">Show all tower cards (developer mode)</span>
            </label>
            <p class="tower-visibility-note">
              Enable to view all tower cards including locked ones. Useful for development and testing.
            </p>
          </div>
        </section>

        <section
          class="panel"
          data-panel="powder"
          id="panel-powder"
          role="tabpanel"
          aria-labelledby="tab-powder"
          hidden
        >
          <!-- Floating toggle button for spire menu (mobile) -->
          <button
            class="spire-menu-toggle"
            id="spire-menu-toggle-powder"
            type="button"
            aria-label="Toggle Spire Navigation"
            aria-expanded="false"
            aria-controls="spire-floating-menu-powder"
          >
            <span class="spire-menu-toggle-icon">☰</span>
          </button>
          <!-- Floating vertical spire menu in top-right corner -->
          <nav class="spire-floating-menu" id="spire-floating-menu-powder" aria-label="Spire Navigation">
            <button
              class="spire-menu-item spire-menu-item--aleph"
              data-tab="powder"
              type="button"
              aria-label="Aleph Spire"
              aria-current="page"
            >
              <span class="spire-menu-icon">ℵ</span>
              <span class="spire-menu-count" id="spire-menu-mote-count">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--bet"
              hidden
              aria-hidden="true"
              data-tab="fluid"
              type="button"
              aria-label="Bet Spire"
            >
              <span class="spire-menu-icon">בּ</span>
              <span class="spire-menu-count" id="spire-menu-fluid-count">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--lamed"
              hidden
              aria-hidden="true"
              data-tab="lamed"
              type="button"
              aria-label="Lamed Spire"
            >
              <span class="spire-menu-icon">ל</span>
              <span class="spire-menu-count" id="spire-menu-lamed-count-powder">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--tsadi"
              hidden
              aria-hidden="true"
              data-tab="tsadi"
              type="button"
              aria-label="Tsadi Spire"
            >
              <span class="spire-menu-icon">צ</span>
              <span class="spire-menu-count" id="spire-menu-tsadi-count-powder">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--shin"
              hidden
              aria-hidden="true"
              data-tab="shin"
              type="button"
              aria-label="Shin Spire"
            >
              <span class="spire-menu-icon">ש</span>
              <span class="spire-menu-count" id="spire-menu-shin-count-powder">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--kuf"
              hidden
              aria-hidden="true"
              data-tab="kuf"
              type="button"
              aria-label="Kuf Spire"
            >
              <span class="spire-menu-icon">ק</span>
              <span class="spire-menu-count" id="spire-menu-kuf-count-powder">0</span>
            </button>
          </nav>
          <section class="powder-stage" id="powder-stage" aria-label="Spire">
            <article class="card powder-simulation" id="powder-simulation-card">
              <div class="powder-basin" id="powder-basin">
                <canvas
                  id="powder-canvas"
                  width="240"
                  height="320"
                  role="img"
                  aria-label="Spire simulation"
                ></canvas>
                <div class="powder-viewport" id="powder-viewport">
                  <div
                    class="powder-wall-hitbox powder-wall-hitbox-left"
                    id="powder-wall-hitbox-left"
                    aria-hidden="true"
                  ></div>
                  <div class="powder-wall powder-wall-left" id="powder-wall-left" aria-hidden="true"></div>
                  <div
                    class="powder-wall-hitbox powder-wall-hitbox-right"
                    id="powder-wall-hitbox-right"
                    aria-hidden="true"
                  ></div>
                  <div class="powder-wall powder-wall-right" id="powder-wall-right" aria-hidden="true">
                    <!-- Display the progress marker on the right wall so it no longer overlaps the crest label. -->
                    <div class="powder-glyph-column" data-powder-glyph-column="right"></div>
                  </div>
                </div>
                <div class="powder-alt-render-panel">
                  <button
                    class="powder-alt-render-toggle"
                    id="powder-alt-render-toggle"
                    type="button"
                    aria-controls="powder-alt-render"
                    aria-pressed="false"
                  >
                    Show Bet Wall Render
                  </button>
                  <div class="powder-alt-render" id="powder-alt-render" hidden>
                    <div
                      class="powder-alt-render__frame"
                      role="img"
                      aria-label="Preserved Bet Spire walls rendered within the Aleph study"
                    >
                      <div class="powder-alt-render__wall powder-alt-render__wall--left" aria-hidden="true"></div>
                      <div class="powder-alt-render__fluid" aria-hidden="true">
                        <div class="powder-alt-render__glow"></div>
                      </div>
                      <div class="powder-alt-render__wall powder-alt-render__wall--right" aria-hidden="true"></div>
                    </div>
                    <p class="powder-alt-render__caption">
                      Bet walls now live as an Aleph render—toggle to compare the terrarium layouts.
                    </p>
                  </div>
                </div>
              </div>
            </article>
          </section>
          <section class="panel-grid powder-summary" aria-label="Aleph Spire reference">
            <article class="card powder-overview">
              <h3>Aleph Spire</h3>
              <dl class="powder-metrics">
                <div>
                  <dt>Height to Next Glyph</dt>
                  <dd id="powder-next-glyph-progress">—</dd>
                </div>
                <div>
                  <dt>Mote Bank</dt>
                  <dd id="powder-mote-bank">0 Motes</dd>
                </div>
                <div>
                  <dt>Fall Rate</dt>
                  <dd id="powder-mote-rate">1.00 Motes/sec</dd>
                </div>
                <div>
                  <dt>Idle Multiplier</dt>
                  <dd id="powder-idle-multiplier">0 achievements</dd>
                </div>
              </dl>
            </article>
          </section>
          <section class="panel-grid spire-options-grid" aria-label="Aleph Spire options">
            <article class="card spire-options-card">
              <button
                class="action-button spire-options-trigger"
                type="button"
                id="powder-options-toggle-button"
                aria-expanded="false"
                aria-controls="powder-options-menu"
              >
                <span class="spire-options-glyph" aria-hidden="true">ℵ</span>
                <span>Spire Options</span>
              </button>
              <div
                class="spire-options-menu"
                id="powder-options-menu"
                data-open="false"
                aria-hidden="true"
                hidden
              >
                <div class="settings-toggle" id="powder-mote-glow-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="powder-mote-glow-title">Luminous motes</span>
                    <span
                      class="settings-toggle-description"
                      id="powder-mote-glow-description"
                      >Soft glow on resting motes and a trailing shimmer while they fall.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="powder-mote-glow-toggle">
                    <input
                      type="checkbox"
                      id="powder-mote-glow-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="powder-mote-glow-title"
                      aria-describedby="powder-mote-glow-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="powder-mote-glow-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="powder-background-stars-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="powder-background-stars-title">Background stars</span>
                    <span
                      class="settings-toggle-description"
                      id="powder-background-stars-description"
                      >Twinkling white and gold stars that swim in the background.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="powder-background-stars-toggle">
                    <input
                      type="checkbox"
                      id="powder-background-stars-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="powder-background-stars-title"
                      aria-describedby="powder-background-stars-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="powder-background-stars-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="powder-mote-trails-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="powder-mote-trails-title">Mote falling trails</span>
                    <span
                      class="settings-toggle-description"
                      id="powder-mote-trails-description"
                      >Glowing trails behind falling motes for enhanced visual effect.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="powder-mote-trails-toggle">
                    <input
                      type="checkbox"
                      id="powder-mote-trails-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="powder-mote-trails-title"
                      aria-describedby="powder-mote-trails-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="powder-mote-trails-state">On</span>
                  </label>
                </div>
                <!-- Developer-only option to overlap Aleph spire render margins. -->
                <div class="settings-toggle" id="powder-render-overlap-row" hidden aria-hidden="true">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="powder-render-overlap-title">🔧 Render overlap</span>
                    <span
                      class="settings-toggle-description"
                      id="powder-render-overlap-description"
                      >Developer: Extend the Aleph render to overlap 0-3 layout margins.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="powder-render-overlap-select">
                    <span class="screen-reader-only">Render overlap level</span>
                    <select
                      id="powder-render-overlap-select"
                      class="settings-select"
                      aria-labelledby="powder-render-overlap-title"
                      aria-describedby="powder-render-overlap-description"
                    >
                      <option value="0">No overlap</option>
                      <option value="1">Overlap 1 margin</option>
                      <option value="2">Overlap 2 margins</option>
                      <option value="3">Overlap 3 margins</option>
                    </select>
                  </label>
                </div>
                <button class="action-button ghost spire-options-close" type="button">Close</button>
              </div>
            </article>
          </section>
        </section>

        <section
          class="panel"
          data-panel="fluid"
          id="panel-fluid"
          role="tabpanel"
          aria-labelledby="tab-fluid"
          hidden
        >
          <header class="panel-header">Bet Spire</header>
          
          <!-- Particle physics render -->
          <section class="fluid-grid" aria-label="Bet Spire Render">
            <article class="card powder-simulation" id="bet-spire-simulation-card">
              <div class="powder-basin" id="bet-spire-basin">
                <canvas
                  id="bet-spire-canvas"
                  width="240"
                  height="320"
                  role="img"
                  aria-label="Bet Spire particle simulation"
                ></canvas>
              </div>
            </article>
          </section>
          
          <!-- Particle Inventory Table -->
          <section class="fluid-grid" aria-label="Scintilla Inventory">
            <article class="card">
              <header class="card-header">Scintilla Inventory</header>
              <div class="card-content">
                <table class="particle-inventory-table" id="bet-particle-inventory">
                  <thead>
                    <tr>
                      <th>Scintilla Type</th>
                    </tr>
                  </thead>
                  <tbody id="bet-particle-inventory-body">
                    <!-- Rows will be populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </article>
          </section>
          
          <!-- BET Spire Upgrade Menu -->
          <section class="fluid-grid" aria-label="Bet Spire Upgrades">
            <article class="card bet-upgrade-card" id="bet-upgrade-menu">
              <header class="card-header">
                <h3>Particle Generators</h3>
              </header>
              
              <!-- Particle Factor Display -->
              <div class="bet-factor-display">
                <div class="bet-factor-stat" id="bet-particle-factor">Particle Factor: 1</div>
                <div class="bet-factor-stat" id="bet-particle-equation">No particles yet</div>
                <div class="bet-factor-stat" id="bet-milestone-progress">Next BET glyph at 10 (0%)</div>
                <div class="bet-factor-stat" id="bet-glyphs-earned">BET Glyphs Earned: 0</div>
                <div class="bet-factor-stat" id="bet-total-production">Total: 0.000 particles/s</div>
              </div>
              
              <!-- Generator List -->
              <div class="bet-generator-list">
                <!-- Generator items will be populated by JavaScript -->
              </div>
            </article>
          </section>
          
          <!-- Bet Spire Options -->
          <section class="panel-grid spire-options-grid" aria-label="Bet Spire options">
            <article class="card spire-options-card">
              <button
                class="action-button spire-options-trigger"
                type="button"
                id="bet-spire-options-toggle-button"
                aria-expanded="false"
                aria-controls="bet-spire-options-menu"
              >
                <span class="spire-options-glyph" aria-hidden="true">בּ</span>
                <span>Spire Options</span>
              </button>
              <div
                class="spire-options-menu"
                id="bet-spire-options-menu"
                data-open="false"
                aria-hidden="true"
                hidden
              >
                <div class="settings-toggle" id="bet-particle-trails-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="bet-particle-trails-title">Particle Trails</span>
                    <span
                      class="settings-toggle-description"
                      id="bet-particle-trails-description"
                      >Glowing trails behind moving particles for enhanced visual effect.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="bet-particle-trails-toggle">
                    <input
                      type="checkbox"
                      id="bet-particle-trails-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="bet-particle-trails-title"
                      aria-describedby="bet-particle-trails-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="bet-particle-trails-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="bet-forge-glow-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="bet-forge-glow-title">Forge & Generator Glow</span>
                    <span
                      class="settings-toggle-description"
                      id="bet-forge-glow-description"
                      >Soft glow effect on the central forge and particle generators.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="bet-forge-glow-toggle">
                    <input
                      type="checkbox"
                      id="bet-forge-glow-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="bet-forge-glow-title"
                      aria-describedby="bet-forge-glow-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="bet-forge-glow-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="bet-smooth-rendering-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="bet-smooth-rendering-title">Smooth Rendering</span>
                    <span
                      class="settings-toggle-description"
                      id="bet-smooth-rendering-description"
                      >Toggle between smooth (anti-aliased) and pixelated (crisp) rendering.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="bet-smooth-rendering-toggle">
                    <input
                      type="checkbox"
                      id="bet-smooth-rendering-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="bet-smooth-rendering-title"
                      aria-describedby="bet-smooth-rendering-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="bet-smooth-rendering-state">On</span>
                  </label>
                </div>
                
                <!-- Developer-only debug controls (hidden unless developer mode is active) -->
                <div class="settings-toggle" id="bet-particle-spawning-toggle-row" hidden aria-hidden="true">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="bet-particle-spawning-title">🔧 Particle Spawning</span>
                    <span
                      class="settings-toggle-description"
                      id="bet-particle-spawning-description"
                      >Developer: Enable or disable particle spawning.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="bet-particle-spawning-toggle">
                    <input
                      type="checkbox"
                      id="bet-particle-spawning-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="bet-particle-spawning-title"
                      aria-describedby="bet-particle-spawning-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="bet-particle-spawning-state">On</span>
                  </label>
                </div>
                
                <div class="settings-toggle" id="bet-particle-merging-toggle-row" hidden aria-hidden="true">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="bet-particle-merging-title">🔧 Particle Merging</span>
                    <span
                      class="settings-toggle-description"
                      id="bet-particle-merging-description"
                      >Developer: Enable or disable particle size merging (100 small → 1 medium).</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="bet-particle-merging-toggle">
                    <input
                      type="checkbox"
                      id="bet-particle-merging-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="bet-particle-merging-title"
                      aria-describedby="bet-particle-merging-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="bet-particle-merging-state">On</span>
                  </label>
                </div>
                
                <!-- Developer-only toggle for merge shockwave bursts. -->
                <div class="settings-toggle" id="bet-merge-shockwaves-toggle-row" hidden aria-hidden="true">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="bet-merge-shockwaves-title">🔧 Merge Shockwaves</span>
                    <span
                      class="settings-toggle-description"
                      id="bet-merge-shockwaves-description"
                      >Developer: Enable or disable the burst shockwave when particles merge.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="bet-merge-shockwaves-toggle">
                    <input
                      type="checkbox"
                      id="bet-merge-shockwaves-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="bet-merge-shockwaves-title"
                      aria-describedby="bet-merge-shockwaves-description"
                      aria-checked="false"
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="bet-merge-shockwaves-state">Off</span>
                  </label>
                </div>

                <!-- Developer-only toggle for subtle particle veer motion. -->
                <div class="settings-toggle" id="bet-particle-veer-toggle-row" hidden aria-hidden="true">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="bet-particle-veer-title">🔧 Particle Veer</span>
                    <span
                      class="settings-toggle-description"
                      id="bet-particle-veer-description"
                      >Developer: Apply subtle randomized veering to particle motion.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="bet-particle-veer-toggle">
                    <input
                      type="checkbox"
                      id="bet-particle-veer-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="bet-particle-veer-title"
                      aria-describedby="bet-particle-veer-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="bet-particle-veer-state">On</span>
                  </label>
                </div>

                <!-- Developer-only toggle for gentle small-tier generator gravity. -->
                <div class="settings-toggle" id="bet-small-tier-generator-gravity-toggle-row" hidden aria-hidden="true">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="bet-small-tier-generator-gravity-title"
                      >🔧 Small Tier Generator Gravity</span
                    >
                    <span
                      class="settings-toggle-description"
                      id="bet-small-tier-generator-gravity-description"
                      >Developer: Apply an extra gentle pull that nudges small particles toward their generators.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="bet-small-tier-generator-gravity-toggle">
                    <input
                      type="checkbox"
                      id="bet-small-tier-generator-gravity-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="bet-small-tier-generator-gravity-title"
                      aria-describedby="bet-small-tier-generator-gravity-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="bet-small-tier-generator-gravity-state">On</span>
                  </label>
                </div>

                <!-- Developer-only toggle for weak medium-tier forge gravity. -->
                <div class="settings-toggle" id="bet-medium-tier-forge-gravity-toggle-row" hidden aria-hidden="true">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="bet-medium-tier-forge-gravity-title"
                      >🔧 Medium Tier Forge Gravity</span
                    >
                    <span
                      class="settings-toggle-description"
                      id="bet-medium-tier-forge-gravity-description"
                      >Developer: Apply an extra weak pull that guides medium particles toward the forge.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="bet-medium-tier-forge-gravity-toggle">
                    <input
                      type="checkbox"
                      id="bet-medium-tier-forge-gravity-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="bet-medium-tier-forge-gravity-title"
                      aria-describedby="bet-medium-tier-forge-gravity-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="bet-medium-tier-forge-gravity-state">On</span>
                  </label>
                </div>

                <div class="settings-toggle" id="bet-particle-promotion-toggle-row" hidden aria-hidden="true">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="bet-particle-promotion-title">🔧 Particle Promotion</span>
                    <span
                      class="settings-toggle-description"
                      id="bet-particle-promotion-description"
                      >Developer: Enable or disable particle tier promotion at the forge (medium → next tier small).</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="bet-particle-promotion-toggle">
                    <input
                      type="checkbox"
                      id="bet-particle-promotion-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="bet-particle-promotion-title"
                      aria-describedby="bet-particle-promotion-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="bet-particle-promotion-state">On</span>
                  </label>
                </div>
                
                <button class="action-button ghost spire-options-close" type="button">Close</button>
              </div>
            </article>
          </section>
          
          <!-- Floating toggle button for spire menu (mobile) -->
          <button
            class="spire-menu-toggle"
            id="spire-menu-toggle-fluid"
            type="button"
            aria-label="Toggle Spire Navigation"
            aria-expanded="false"
            aria-controls="spire-floating-menu-fluid"
          >
            <span class="spire-menu-toggle-icon">☰</span>
          </button>
          <!-- Floating vertical spire menu in top-right corner -->
          <nav class="spire-floating-menu" id="spire-floating-menu-fluid" aria-label="Spire Navigation">
            <button
              class="spire-menu-item spire-menu-item--aleph"
              data-tab="powder"
              type="button"
              aria-label="Aleph Spire"
            >
              <span class="spire-menu-icon">ℵ</span>
              <span class="spire-menu-count" id="spire-menu-mote-count-fluid">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--bet"
              hidden
              aria-hidden="true"
              data-tab="fluid"
              type="button"
              aria-label="Bet Spire"
              aria-current="page"
            >
              <span class="spire-menu-icon">בּ</span>
              <span class="spire-menu-count" id="spire-menu-fluid-count-fluid">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--lamed"
              hidden
              aria-hidden="true"
              data-tab="lamed"
              type="button"
              aria-label="Lamed Spire"
            >
              <span class="spire-menu-icon">ל</span>
              <span class="spire-menu-count" id="spire-menu-lamed-count-fluid">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--tsadi"
              hidden
              aria-hidden="true"
              data-tab="tsadi"
              type="button"
              aria-label="Tsadi Spire"
            >
              <span class="spire-menu-icon">צ</span>
              <span class="spire-menu-count" id="spire-menu-tsadi-count-fluid">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--shin"
              hidden
              aria-hidden="true"
              data-tab="shin"
              type="button"
              aria-label="Shin Spire"
            >
              <span class="spire-menu-icon">ש</span>
              <span class="spire-menu-count" id="spire-menu-shin-count-fluid">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--kuf"
              hidden
              aria-hidden="true"
              data-tab="kuf"
              type="button"
              aria-label="Kuf Spire"
            >
              <span class="spire-menu-icon">ק</span>
              <span class="spire-menu-count" id="spire-menu-kuf-count-fluid">0</span>
            </button>
          </nav>
        </section>

        <section
          class="panel"
          data-panel="lamed"
          id="panel-lamed"
          role="tabpanel"
          aria-labelledby="tab-lamed"
          hidden
        >
          <!-- Floating toggle button for spire menu (mobile) -->
          <button
            class="spire-menu-toggle"
            id="spire-menu-toggle-lamed"
            type="button"
            aria-label="Toggle Spire Navigation"
            aria-expanded="false"
            aria-controls="spire-floating-menu-lamed"
          >
            <span class="spire-menu-toggle-icon">☰</span>
          </button>
          <!-- Floating vertical spire menu in top-right corner -->
          <nav class="spire-floating-menu" id="spire-floating-menu-lamed" aria-label="Spire Navigation">
            <button
              class="spire-menu-item spire-menu-item--aleph"
              data-tab="powder"
              type="button"
              aria-label="Aleph Spire"
            >
              <span class="spire-menu-icon">ℵ</span>
              <span class="spire-menu-count" id="spire-menu-mote-count-lamed">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--bet"
              hidden
              aria-hidden="true"
              data-tab="fluid"
              type="button"
              aria-label="Bet Spire"
            >
              <span class="spire-menu-icon">בּ</span>
              <span class="spire-menu-count" id="spire-menu-fluid-count-lamed">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--lamed"
              hidden
              aria-hidden="true"
              data-tab="lamed"
              type="button"
              aria-label="Lamed Spire"
              aria-current="page"
            >
              <span class="spire-menu-icon">ל</span>
              <span class="spire-menu-count" id="spire-menu-lamed-count">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--tsadi"
              hidden
              aria-hidden="true"
              data-tab="tsadi"
              type="button"
              aria-label="Tsadi Spire"
            >
              <span class="spire-menu-icon">צ</span>
              <span class="spire-menu-count" id="spire-menu-tsadi-count-lamed">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--shin"
              hidden
              aria-hidden="true"
              data-tab="shin"
              type="button"
              aria-label="Shin Spire"
            >
              <span class="spire-menu-icon">ש</span>
              <span class="spire-menu-count" id="spire-menu-shin-count-lamed">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--kuf"
              hidden
              aria-hidden="true"
              data-tab="kuf"
              type="button"
              aria-label="Kuf Spire"
            >
              <span class="spire-menu-icon">ק</span>
              <span class="spire-menu-count" id="spire-menu-kuf-count-lamed">0</span>
            </button>
          </nav>
          <header class="panel-header" aria-label="Lamed Spire"></header>
          <section class="lamed-grid" aria-label="Lamed Spire Overview">
            <div class="lamed-simulation-slot" id="lamed-simulation-host">
              <article class="card powder-simulation lamed-simulation-card" id="lamed-simulation-card">
                <div class="powder-basin lamed-basin" id="lamed-basin">
                  <!-- Starfield backdrop to ground the Lamed Spire in open space. -->
                  <div class="lamed-starfield" aria-hidden="true"></div>
                  <canvas
                    id="lamed-canvas"
                    width="240"
                    height="320"
                    role="img"
                    aria-label="Gravitational spark simulation"
                  ></canvas>
                  <div class="powder-viewport lamed-viewport" id="lamed-viewport">
                    <div class="powder-glyph-column" data-lamed-glyph-column="center"></div>
                  </div>
                </div>
              </article>
            </div>
            <article class="card lamed-metrics-card">
              <h3>Gravitational Metrics</h3>
              <dl class="lamed-metrics">
                <div>
                  <dt>Celestial Type</dt>
                  <dd id="lamed-tier">Proto-star</dd>
                </div>
                <div>
                  <dt>Star Mass</dt>
                  <dd id="lamed-star-mass">10.00</dd>
                </div>
                <div>
                  <dt>Next Milestone</dt>
                  <dd id="lamed-next-tier">Main Sequence (100)</dd>
                </div>
                <div>
                  <dt>Orbiting Stars</dt>
                  <dd id="lamed-orbiting-count">0</dd>
                </div>
                <div>
                  <dt>Absorptions/min</dt>
                  <dd id="lamed-absorptions-rate">0.0</dd>
                </div>
                <div>
                  <dt>Mass Inflow/min</dt>
                  <dd id="lamed-mass-inflow">0.0</dd>
                </div>
                <div>
                  <dt>Idle Spark Bank</dt>
                  <dd id="lamed-reservoir">0 Sparks</dd>
                </div>
                <div>
                  <dt>Spark Generation Rate</dt>
                  <dd id="lamed-growth-rate">1.00 sparks/sec</dd>
                </div>
              </dl>
              <div class="lamed-upgrades">
                <!-- Orbital drag upgrade controls remain available for tuning inward drift. -->
                <div class="lamed-upgrade-block">
                  <h4>Orbital Drag System</h4>
                  <p>Upgrade drag coefficient to promote inward migration of orbiting stars.</p>
                  <div class="lamed-drag-info">
                    <div>
                      <dt>Drag Level</dt>
                      <dd id="lamed-drag-level">0</dd>
                    </div>
                    <div>
                      <dt>Coefficient (k)</dt>
                      <dd id="lamed-drag-coefficient">0.00</dd>
                    </div>
                  </div>
                  <button
                    id="lamed-upgrade-drag-btn"
                    class="lamed-upgrade-btn"
                    aria-label="Upgrade drag coefficient"
                  >
                    Upgrade Drag (Cost: <span id="lamed-drag-cost">10</span> Sparks)
                  </button>
                </div>
                <!-- Stellar mass upgrade controls let players bulk up orbiting sparks. -->
                <div class="lamed-upgrade-block">
                  <h4>Stellar Mass Infusion</h4>
                  <p>Increase orbiting spark mass so each capture deposits more material into the core.</p>
                  <div class="lamed-star-mass-info">
                    <div>
                      <dt>Mass Level</dt>
                      <dd id="lamed-star-mass-level">0</dd>
                    </div>
                    <div>
                      <dt>Orbiting Spark Mass</dt>
                      <dd id="lamed-star-mass-value">1</dd>
                    </div>
                  </div>
                  <button
                    id="lamed-upgrade-star-mass-btn"
                    class="lamed-upgrade-btn"
                    aria-label="Upgrade orbiting spark mass"
                  >
                    Upgrade Spark Mass (Cost: <span id="lamed-star-mass-cost">5</span> Sparks)
                  </button>
                </div>
              </div>
              <p class="lamed-status-note" id="lamed-status-note">
                Stars spawn in orbital rings around the central body. Drag causes inward spiral migration.
              </p>
            </article>
            <!-- Lamed Spire Options dropdown for visual settings -->
            <article class="card lamed-spire-options-card">
              <button
                class="action-button lamed-spire-options-trigger"
                type="button"
                id="lamed-options-toggle-button"
                aria-expanded="false"
                aria-controls="lamed-options-menu"
              >
                <span class="lamed-spire-options-glyph" aria-hidden="true">ל</span>
                <span>Spire Options</span>
              </button>
              <div
                class="lamed-spire-options-menu"
                id="lamed-options-menu"
                data-open="false"
                aria-hidden="true"
                hidden
              >
                <button class="action-button ghost" type="button" id="lamed-graphics-level-button">
                  Graphics · High
                </button>
                <div class="settings-toggle" id="lamed-dust-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="lamed-dust-title">Dust Particles</span>
                    <span class="settings-toggle-description" id="lamed-dust-description"
                      >Swirling accretion disk particles around the celestial body.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="lamed-dust-toggle">
                    <input
                      type="checkbox"
                      id="lamed-dust-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="lamed-dust-title"
                      aria-describedby="lamed-dust-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="lamed-dust-toggle-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="lamed-trails-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="lamed-trails-title">Star Trails</span>
                    <span class="settings-toggle-description" id="lamed-trails-description"
                      >Colorful velocity trails behind orbiting stars.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="lamed-trails-toggle">
                    <input
                      type="checkbox"
                      id="lamed-trails-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="lamed-trails-title"
                      aria-describedby="lamed-trails-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="lamed-trails-toggle-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="lamed-sun-detail-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="lamed-sun-detail-title">Sun Detail</span>
                    <span class="settings-toggle-description" id="lamed-sun-detail-description"
                      >Animated sunspots, corona shimmer, and limb darkening effects.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="lamed-sun-detail-toggle">
                    <input
                      type="checkbox"
                      id="lamed-sun-detail-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="lamed-sun-detail-title"
                      aria-describedby="lamed-sun-detail-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="lamed-sun-detail-toggle-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="lamed-splashes-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="lamed-splashes-title">Sun Splashes</span>
                    <span class="settings-toggle-description" id="lamed-splashes-description"
                      >Lens flare and geyser bursts when stars enter the sun.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="lamed-splashes-toggle">
                    <input
                      type="checkbox"
                      id="lamed-splashes-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="lamed-splashes-title"
                      aria-describedby="lamed-splashes-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="lamed-splashes-toggle-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="lamed-shooting-trails-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="lamed-shooting-trails-title">Shooting Star Trails</span>
                    <span class="settings-toggle-description" id="lamed-shooting-trails-description"
                      >Luminous streaks following shooting stars across the sky.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="lamed-shooting-trails-toggle">
                    <input
                      type="checkbox"
                      id="lamed-shooting-trails-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="lamed-shooting-trails-title"
                      aria-describedby="lamed-shooting-trails-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="lamed-shooting-trails-toggle-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="lamed-flashes-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="lamed-flashes-title">Spawn Flashes</span>
                    <span class="settings-toggle-description" id="lamed-flashes-description"
                      >Bright flash effects when new stars spawn into orbit.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="lamed-flashes-toggle">
                    <input
                      type="checkbox"
                      id="lamed-flashes-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="lamed-flashes-title"
                      aria-describedby="lamed-flashes-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="lamed-flashes-toggle-state">On</span>
                  </label>
                </div>
                <button class="action-button ghost spire-options-close" type="button">Close</button>
              </div>
            </article>
          </section>
        </section>

        <section
          class="panel"
          data-panel="tsadi"
          id="panel-tsadi"
          role="tabpanel"
          aria-labelledby="tab-tsadi"
          hidden
        >
          <!-- Floating toggle button for spire menu (mobile) -->
          <button
            class="spire-menu-toggle"
            id="spire-menu-toggle-tsadi"
            type="button"
            aria-label="Toggle Spire Navigation"
            aria-expanded="false"
            aria-controls="spire-floating-menu-tsadi"
          >
            <span class="spire-menu-toggle-icon">☰</span>
          </button>
          <!-- Floating vertical spire menu in top-right corner -->
          <nav class="spire-floating-menu" id="spire-floating-menu-tsadi" aria-label="Spire Navigation">
            <button
              class="spire-menu-item spire-menu-item--aleph"
              data-tab="powder"
              type="button"
              aria-label="Aleph Spire"
            >
              <span class="spire-menu-icon">ℵ</span>
              <span class="spire-menu-count" id="spire-menu-mote-count-tsadi">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--bet"
              hidden
              aria-hidden="true"
              data-tab="fluid"
              type="button"
              aria-label="Bet Spire"
            >
              <span class="spire-menu-icon">בּ</span>
              <span class="spire-menu-count" id="spire-menu-fluid-count-tsadi">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--lamed"
              hidden
              aria-hidden="true"
              data-tab="lamed"
              type="button"
              aria-label="Lamed Spire"
            >
              <span class="spire-menu-icon">ל</span>
              <span class="spire-menu-count" id="spire-menu-lamed-count-tsadi">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--tsadi"
              hidden
              aria-hidden="true"
              data-tab="tsadi"
              type="button"
              aria-label="Tsadi Spire"
              aria-current="page"
            >
              <span class="spire-menu-icon">צ</span>
              <span class="spire-menu-count" id="spire-menu-tsadi-count">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--shin"
              hidden
              aria-hidden="true"
              data-tab="shin"
              type="button"
              aria-label="Shin Spire"
            >
              <span class="spire-menu-icon">ש</span>
              <span class="spire-menu-count" id="spire-menu-shin-count-tsadi">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--kuf"
              hidden
              aria-hidden="true"
              data-tab="kuf"
              type="button"
              aria-label="Kuf Spire"
            >
              <span class="spire-menu-icon">ק</span>
              <span class="spire-menu-count" id="spire-menu-kuf-count-tsadi">0</span>
            </button>
          </nav>
          <header class="panel-header" aria-label="Tsadi Spire"></header>
          <section class="tsadi-grid" aria-label="Tsadi Spire Overview">
            <div class="tsadi-simulation-slot" id="tsadi-simulation-host">
              <article class="card powder-simulation tsadi-simulation-card" id="tsadi-simulation-card">
                <div class="powder-basin tsadi-basin" id="tsadi-basin">
                  <button
                    class="tsadi-binding-handle"
                    id="tsadi-binding-handle"
                    type="button"
                    title="Drag to place a Waals bond"
                    aria-label="Drag to place a Waals bond"
                  >
                    <!-- Hollow triangle with three bonded spheres to represent a binding agent. -->
                    <svg class="tsadi-binding-icon" viewBox="0 0 64 64" aria-hidden="true" focusable="false">
                      <path
                        d="M32 8 10 48h44Z"
                        fill="none"
                        stroke="currentColor"
                        stroke-linejoin="round"
                        stroke-width="3"
                      ></path>
                      <circle cx="32" cy="8" r="6" fill="currentColor"></circle>
                      <circle cx="54" cy="48" r="6" fill="currentColor"></circle>
                      <circle cx="10" cy="48" r="6" fill="currentColor"></circle>
                    </svg>
                  </button>
                  <canvas
                    id="tsadi-canvas"
                    width="240"
                    height="320"
                    role="img"
                    aria-label="Particle fusion simulation"
                  ></canvas>
                  <div class="powder-viewport tsadi-viewport" id="tsadi-viewport">
                    <div class="powder-glyph-column" data-tsadi-glyph-column="nodes"></div>
                  </div>
                </div>
              </article>
            </div>
            <article class="card tsadi-metrics-card">
              <h3>Particle Fusion Metrics</h3>
              <dl class="tsadi-metrics">
                <div>
                  <dt>Highest Tier</dt>
                  <dd id="tsadi-highest-tier">Alpha (α) – Tier 1</dd>
                </div>
                <div>
                  <dt>Tsadi Glyphs Earned</dt>
                  <dd id="tsadi-reservoir">0 Tsadi Glyphs</dd>
                </div>
                <div>
                  <dt>Particle Bank</dt>
                  <dd id="tsadi-bank">0 Particles</dd>
                </div>
                <div>
                  <dt>Waals Reserve</dt>
                  <dd id="tsadi-binding-agent-count">0 Waals</dd>
                </div>
                <div>
                  <dt>Atom Generation Rate</dt>
                  <dd id="tsadi-generation-rate">2.00 atoms/sec</dd>
                </div>
                <div>
                  <dt>Active Atoms</dt>
                  <dd id="tsadi-particle-count">0 atoms</dd>
                </div>
              </dl>
              <p class="tsadi-status-note" id="tsadi-status-note">
                Atoms bounce and collide. When two atoms of the same tier collide, they fuse into a higher tier.
                Each new tier reached earns a Tsadi glyph. Calm atoms (with zero or negative repelling force) can be tied
                together with binding agents to form molecules for bonus effects.
              </p>
            </article>
            <article class="card tsadi-codex-card">
              <div class="tsadi-codex-header">
                <div class="tsadi-codex-title">
                  <h3>Alchemy Codex</h3>
                  <span class="tsadi-codex-summary" id="tsadi-codex-summary">(0 Entries: +0 particles/hour)</span>
                </div>
                <button class="tsadi-codex-button" id="tsadi-codex-button" type="button" aria-expanded="false">
                  Show Alchemy Codex
                </button>
              </div>
              <div class="tsadi-codex-panel" id="tsadi-codex-panel" aria-hidden="true" hidden>
                <p class="tsadi-codex-note">Tap a formula to reveal the generated molecule sketch.</p>
                <ul
                  class="tsadi-codex-list"
                  id="tsadi-codex-list"
                  aria-live="polite"
                  aria-label="Discovered molecules"
                ></ul>
              </div>
            </article>
            <article class="card tsadi-upgrades-card">
              <h3>Permanent Upgrades</h3>
              <div class="tsadi-upgrades">
                <div class="tsadi-upgrade-item">
                  <div class="tsadi-upgrade-header">
                    <span class="tsadi-upgrade-name">Reduce Repelling Force</span>
                    <span class="tsadi-upgrade-level" id="tsadi-upgrade-repelling-level">Level 0</span>
                  </div>
                  <p class="tsadi-upgrade-description" id="tsadi-upgrade-repelling-description">
                    Reduces particle repelling force by 50% per level. When force becomes negative, particles attract instead of repel.
                  </p>
                  <div class="tsadi-upgrade-footer">
                    <span class="tsadi-upgrade-cost" id="tsadi-upgrade-repelling-cost">Cost: 3 Particles</span>
                    <button 
                      class="tsadi-upgrade-button" 
                      id="tsadi-upgrade-repelling-button"
                      type="button"
                      aria-label="Purchase Reduce Repelling Force upgrade"
                    >
                      Purchase
                    </button>
                  </div>
                </div>
                <div class="tsadi-upgrade-item">
                  <div class="tsadi-upgrade-header">
                    <span class="tsadi-upgrade-name">Empower Wave of Force</span>
                    <span class="tsadi-upgrade-level" id="tsadi-upgrade-wave-level">Level 0</span>
                  </div>
                  <p class="tsadi-upgrade-description" id="tsadi-upgrade-wave-description">
                    Unlocks the Tsadi wave of force so taps push nearby particles. Increases both push strength and radius.
                  </p>
                  <div class="tsadi-upgrade-footer">
                    <span class="tsadi-upgrade-cost" id="tsadi-upgrade-wave-cost">Cost: 1 Particle</span>
                    <button
                      class="tsadi-upgrade-button"
                      id="tsadi-upgrade-wave-button"
                      type="button"
                      aria-label="Purchase Wave of Force upgrade"
                    >
                      Purchase
                    </button>
                  </div>
                </div>
                <div class="tsadi-upgrade-item">
                  <div class="tsadi-upgrade-header">
                    <span class="tsadi-upgrade-name">Starting Tier</span>
                    <span class="tsadi-upgrade-level" id="tsadi-upgrade-tier-level">Level 0</span>
                  </div>
                  <p class="tsadi-upgrade-description" id="tsadi-upgrade-tier-description">
                    Increases the tier of particles spawned into the simulation. Level 1 spawns Alpha particles instead of Null.
                  </p>
                  <div class="tsadi-upgrade-footer">
                    <span class="tsadi-upgrade-cost" id="tsadi-upgrade-tier-cost">Cost: 5 Particles</span>
                    <button 
                      class="tsadi-upgrade-button" 
                      id="tsadi-upgrade-tier-button"
                      type="button"
                      aria-label="Purchase Starting Tier upgrade"
                    >
                      Purchase
                    </button>
                  </div>
                </div>
              </div>
            </article>
          </section>
          <section class="panel-grid spire-options-grid" aria-label="Tsadi Spire options">
            <article class="card spire-options-card">
              <button
                class="action-button spire-options-trigger"
                type="button"
                id="tsadi-options-toggle-button"
                aria-expanded="false"
                aria-controls="tsadi-options-menu"
              >
                <span class="spire-options-glyph" aria-hidden="true">צ</span>
                <span>Spire Options</span>
              </button>
              <div
                class="spire-options-menu"
                id="tsadi-options-menu"
                data-open="false"
                aria-hidden="true"
                hidden
              >
                <button class="action-button ghost" type="button" id="tsadi-graphics-level-button">
                  Graphics · High
                </button>
                <div class="settings-toggle" id="tsadi-force-links-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="tsadi-force-links-title">Force Link Beams</span>
                    <span class="settings-toggle-description" id="tsadi-force-links-description"
                      >Render attractive and repelling filaments between nearby particles.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="tsadi-force-links-toggle">
                    <input
                      type="checkbox"
                      id="tsadi-force-links-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="tsadi-force-links-title"
                      aria-describedby="tsadi-force-links-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="tsadi-force-links-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="tsadi-fusion-effects-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="tsadi-fusion-effects-title">Fusion Flashes</span>
                    <span class="settings-toggle-description" id="tsadi-fusion-effects-description"
                      >Show glow rings when particles collide and fuse.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="tsadi-fusion-effects-toggle">
                    <input
                      type="checkbox"
                      id="tsadi-fusion-effects-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="tsadi-fusion-effects-title"
                      aria-describedby="tsadi-fusion-effects-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="tsadi-fusion-effects-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="tsadi-spawn-effects-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="tsadi-spawn-effects-title">Spawn Ripples</span>
                    <span class="settings-toggle-description" id="tsadi-spawn-effects-description"
                      >Animate flash and ripple effects when new particles enter the basin.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="tsadi-spawn-effects-toggle">
                    <input
                      type="checkbox"
                      id="tsadi-spawn-effects-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="tsadi-spawn-effects-title"
                      aria-describedby="tsadi-spawn-effects-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="tsadi-spawn-effects-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="tsadi-smooth-rendering-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="tsadi-smooth-rendering-title">Smooth Rendering</span>
                    <span class="settings-toggle-description" id="tsadi-smooth-rendering-description"
                      >Enable subpixel rendering for ultra-smooth particle motion without grid snapping.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="tsadi-smooth-rendering-toggle">
                    <input
                      type="checkbox"
                      id="tsadi-smooth-rendering-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="tsadi-smooth-rendering-title"
                      aria-describedby="tsadi-smooth-rendering-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="tsadi-smooth-rendering-state">On</span>
                  </label>
                </div>
                <button class="action-button ghost spire-options-close" type="button">Close</button>
              </div>
            </article>
          </section>
        </section>

        <section
          class="panel"
          data-panel="shin"
          id="panel-shin"
          role="tabpanel"
          aria-labelledby="tab-shin"
          hidden
        >
          <!-- Floating toggle button for spire menu (mobile) -->
          <button
            class="spire-menu-toggle"
            id="spire-menu-toggle-shin"
            type="button"
            aria-label="Toggle Spire Navigation"
            aria-expanded="false"
            aria-controls="spire-floating-menu-shin"
          >
            <span class="spire-menu-toggle-icon">☰</span>
          </button>
          <!-- Floating vertical spire menu in top-right corner -->
          <nav class="spire-floating-menu" id="spire-floating-menu-shin" aria-label="Spire Navigation">
            <button
              class="spire-menu-item spire-menu-item--aleph"
              data-tab="powder"
              type="button"
              aria-label="Aleph Spire"
            >
              <span class="spire-menu-icon">ℵ</span>
              <span class="spire-menu-count" id="spire-menu-mote-count-shin">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--bet"
              hidden
              aria-hidden="true"
              data-tab="fluid"
              type="button"
              aria-label="Bet Spire"
            >
              <span class="spire-menu-icon">בּ</span>
              <span class="spire-menu-count" id="spire-menu-fluid-count-shin">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--lamed"
              hidden
              aria-hidden="true"
              data-tab="lamed"
              type="button"
              aria-label="Lamed Spire"
            >
              <span class="spire-menu-icon">ל</span>
              <span class="spire-menu-count" id="spire-menu-lamed-count-shin">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--tsadi"
              hidden
              aria-hidden="true"
              data-tab="tsadi"
              type="button"
              aria-label="Tsadi Spire"
            >
              <span class="spire-menu-icon">צ</span>
              <span class="spire-menu-count" id="spire-menu-tsadi-count-shin">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--shin"
              hidden
              aria-hidden="true"
              data-tab="shin"
              type="button"
              aria-label="Shin Spire"
              aria-current="page"
            >
              <span class="spire-menu-icon">ש</span>
              <span class="spire-menu-count" id="spire-menu-shin-count">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--kuf"
              hidden
              aria-hidden="true"
              data-tab="kuf"
              type="button"
              aria-label="Kuf Spire"
            >
              <span class="spire-menu-icon">ק</span>
              <span class="spire-menu-count" id="spire-menu-kuf-count-shin">0</span>
            </button>
          </nav>
          <header class="panel-header" aria-label="Shin Spire"></header>
          
          <!-- Shin Spire Game Content Area - Cardinal Warden Reverse Danmaku -->
          <section class="shin-game-content" id="shin-game-content" aria-label="Shin Spire game area">
            <!-- Cardinal Warden Reverse Danmaku Game -->
            <article class="card shin-cardinal-card" id="shin-cardinal-card">
              <div class="shin-cardinal-viewport">
                <canvas
                  id="shin-cardinal-canvas"
                  class="shin-cardinal-canvas"
                  aria-label="Cardinal Warden reverse danmaku game"
                ></canvas>
              </div>
            </article>
          </section>

          <!-- Weapon Slots - Simple slots for firing bullets (positioned between render and grapheme inventory) -->
          <article class="card shin-weapon-slots-card" id="shin-weapon-slots-card">
            <h3>Weapon Slots</h3>
            <div class="shin-weapon-slots-container" id="shin-weapon-slots-container" role="list" aria-live="polite">
              <!-- Weapon slots populated dynamically -->
            </div>
          </article>

          <!-- Grapheme Inventory -->
          <article class="card shin-phoneme-card" id="shin-phoneme-card">
            <h3>Grapheme Collection</h3>
            <div class="shin-phoneme-stats">
              <span>Total Collected: <strong id="shin-phoneme-count">0</strong></span>
              <span>Unlocked: <strong id="shin-unlocked-count">3</strong> / 26</span>
            </div>
            <div class="shin-phoneme-inventory" id="shin-phoneme-inventory" role="list" aria-live="polite">
              <span class="shin-phoneme-empty">No graphemes collected</span>
            </div>
            <div class="shin-grapheme-upgrades">
              <button id="shin-grapheme-unlock-btn" class="shin-weapon-action">
                Unlock Next Grapheme: <span id="shin-grapheme-unlock-cost">250</span> ℸ
              </button>
              <div class="shin-drop-chance-upgrade">
                <span>Drop Chance: <strong id="shin-drop-chance-display">1%</strong></span>
                <button id="shin-drop-chance-upgrade-btn" class="shin-weapon-action">
                  +1% Drop Chance: <span id="shin-drop-chance-cost">100</span> ℸ
                </button>
              </div>
            </div>
          </article>

          <!-- Wave Starting Options -->
          <article class="card shin-wave-start-card">
            <h3>Wave Start Options</h3>
            <p class="shin-wave-start-description">Drag the wheel to select a starting wave.</p>
            <div class="shin-wave-start-controls">
              <label for="shin-wave-carousel">Starting Wave:</label>
              <div class="shin-wave-carousel" id="shin-wave-carousel">
                <div class="shin-wave-carousel-container">
                  <div class="shin-wave-carousel-track" id="shin-wave-carousel-track">
                    <!-- Wave numbers populated dynamically -->
                  </div>
                  <div class="shin-wave-carousel-selector"></div>
                </div>
              </div>
              <button id="shin-wave-start-apply-btn" class="shin-weapon-action">Apply & Restart</button>
            </div>
          </article>

          <!-- Shin Spire Stats Display -->
          <article class="card shin-resource-card">
            <h3>Shin Spire Stats</h3>
            <dl class="shin-metrics">
              <div>
                <dt>Current Wave</dt>
                <dd id="shin-wave-display">Wave 1</dd>
              </div>
              <div>
                <dt>Highest Wave</dt>
                <dd id="shin-highest-wave">0</dd>
              </div>
              <div>
                <dt>Total Equivalence</dt>
                <dd id="shin-total-iterons">0 ℸ</dd>
              </div>
              <div>
                <dt>Shin Glyphs</dt>
                <dd id="shin-glyph-count">0 ש</dd>
              </div>
              <div>
                <dt>Base Health</dt>
                <dd id="shin-base-health">100</dd>
              </div>
            </dl>
            <div class="shin-health-upgrade">
              <button id="shin-health-upgrade-btn" class="shin-weapon-action" disabled>
                Upgrade Health: <span id="shin-health-upgrade-cost">50</span> ℸ
              </button>
            </div>
          </article>

          <!-- Legacy elements kept for compatibility but hidden -->
          <div hidden aria-hidden="true">
            <div id="shin-fractal-content"></div>
            <div id="shin-layer-progress">
              <div id="shin-layer-progress-bar"></div>
              <p id="shin-layer-progress-text"></p>
            </div>
            <div id="shin-fractal-details"></div>
            <div id="shin-fractal-tabs"></div>
            <dd id="shin-iteron-bank">0</dd>
            <dd id="shin-iteration-rate">0/sec</dd>
            <!-- Keep legacy overlay and result elements for compatibility -->
            <div id="shin-cardinal-overlay" hidden></div>
            <div id="shin-cardinal-result" hidden></div>
            <button id="shin-cardinal-start" hidden></button>
            <button id="shin-cardinal-restart" hidden></button>
            <p id="shin-cardinal-result-score"></p>
            <p id="shin-cardinal-result-high"></p>
            <p id="shin-cardinal-result-wave"></p>
          </div>

          <section class="panel-grid spire-options-grid" aria-label="Shin Spire options">
            <article class="card spire-options-card">
              <button
                class="action-button spire-options-trigger"
                type="button"
                id="shin-options-toggle-button"
                aria-expanded="false"
                aria-controls="shin-options-menu"
              >
                <span class="spire-options-glyph" aria-hidden="true">ש</span>
                <span>Spire Options</span>
              </button>
              <div
                class="spire-options-menu"
                id="shin-options-menu"
                data-open="false"
                aria-hidden="true"
                hidden
              >
                <button class="action-button ghost" type="button" id="shin-graphics-level-button">Graphics · High</button>
                <div class="settings-toggle" id="shin-night-mode-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="shin-night-mode-title">Night Mode</span>
                    <span class="settings-toggle-description" id="shin-night-mode-description"
                      >Switch the reverse danmaku canvas to a dark palette with luminous ships.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="shin-night-mode-toggle">
                    <input
                      type="checkbox"
                      id="shin-night-mode-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="shin-night-mode-title"
                      aria-describedby="shin-night-mode-description"
                      aria-checked="false"
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="shin-night-mode-toggle-state">Off</span>
                  </label>
                </div>
                <button class="action-button ghost" type="button" id="shin-enemy-trail-quality-button">Enemy Trail Quality · High</button>
                <button class="action-button ghost" type="button" id="shin-bullet-trail-length-button">Bullet Trails · Long</button>
                <button class="action-button ghost spire-options-close" type="button">Close</button>
              </div>
            </article>
          </section>


        </section>

        <section
          class="panel"
          data-panel="kuf"
          id="panel-kuf"
          role="tabpanel"
          aria-labelledby="tab-kuf"
          hidden
        >
          <!-- Floating toggle button for spire menu (mobile) -->
          <button
            class="spire-menu-toggle"
            id="spire-menu-toggle-kuf"
            type="button"
            aria-label="Toggle Spire Navigation"
            aria-expanded="false"
            aria-controls="spire-floating-menu-kuf"
          >
            <span class="spire-menu-toggle-icon">☰</span>
          </button>
          <!-- Floating vertical spire menu in top-right corner -->
          <nav class="spire-floating-menu" id="spire-floating-menu-kuf" aria-label="Spire Navigation">
            <button
              class="spire-menu-item spire-menu-item--aleph"
              data-tab="powder"
              type="button"
              aria-label="Aleph Spire"
            >
              <span class="spire-menu-icon">ℵ</span>
              <span class="spire-menu-count" id="spire-menu-mote-count-kuf">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--bet"
              hidden
              aria-hidden="true"
              data-tab="fluid"
              type="button"
              aria-label="Bet Spire"
            >
              <span class="spire-menu-icon">בּ</span>
              <span class="spire-menu-count" id="spire-menu-fluid-count-kuf">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--lamed"
              hidden
              aria-hidden="true"
              data-tab="lamed"
              type="button"
              aria-label="Lamed Spire"
            >
              <span class="spire-menu-icon">ל</span>
              <span class="spire-menu-count" id="spire-menu-lamed-count-kuf">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--tsadi"
              hidden
              aria-hidden="true"
              data-tab="tsadi"
              type="button"
              aria-label="Tsadi Spire"
            >
              <span class="spire-menu-icon">צ</span>
              <span class="spire-menu-count" id="spire-menu-tsadi-count-kuf">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--shin"
              hidden
              aria-hidden="true"
              data-tab="shin"
              type="button"
              aria-label="Shin Spire"
            >
              <span class="spire-menu-icon">ש</span>
              <span class="spire-menu-count" id="spire-menu-shin-count-kuf">0</span>
            </button>
            <button
              class="spire-menu-item spire-menu-item--kuf"
              hidden
              aria-hidden="true"
              data-tab="kuf"
              type="button"
              aria-label="Kuf Spire"
              aria-current="page"
            >
              <span class="spire-menu-icon">ק</span>
              <span class="spire-menu-count" id="spire-menu-kuf-count">0</span>
            </button>
          </nav>
          <header class="panel-header" aria-label="Kuf Spire"></header>
          
          <div class="kuf-grid">
            <!-- Simulation card at top -->
            <article class="card kuf-card kuf-card--simulation" id="kuf-simulation-card">
              <div class="kuf-sim-viewport">
                <canvas
                  id="kuf-simulation-canvas"
                  width="600"
                  height="800"
                  aria-label="Kuf battlefield simulation"
                ></canvas>
                <!-- Pre-simulation menu with unit deployment and upgrades -->
                <div class="kuf-sim-menu" id="kuf-sim-menu">
                  <button class="action-button kuf-sim-menu-start" type="button" id="kuf-start-button">Start Simulation</button>

                  <div class="kuf-sim-map" aria-live="polite">
                    <p class="kuf-sim-map-label">Battlefield</p>
                    <div class="kuf-map-list" id="kuf-map-list" aria-label="Battlefield selection"></div>
                    <p class="kuf-sim-map-meta" id="kuf-map-difficulty"></p>
                    <p class="kuf-sim-map-description" id="kuf-map-description">Select a battlefield to see its briefing.</p>
                    <ul class="kuf-map-mechanics" id="kuf-map-mechanics">
                      <li>No unique mechanics documented yet.</li>
                    </ul>
                  </div>

                  <div class="kuf-sim-menu-units">
                    <!-- Marine -->
                    <div class="kuf-sim-unit">
                      <div class="kuf-sim-unit-header">
                        <span class="kuf-sim-unit-name">Marine</span>
                        <div class="kuf-sim-unit-count-controls">
                          <button class="kuf-unit-btn kuf-unit-btn-minus" type="button" data-unit="marines" data-action="minus">−</button>
                          <span class="kuf-sim-unit-count" id="kuf-marines-count">0</span>
                          <button class="kuf-unit-btn kuf-unit-btn-plus" type="button" data-unit="marines" data-action="plus">+</button>
                        </div>
                        <div class="kuf-sim-unit-cost">
                          <span class="kuf-sim-unit-cost-each">5</span> ea.
                          (<span id="kuf-marines-total-cost">0</span>)
                        </div>
                        <button class="kuf-unit-upgrade-btn" type="button" data-unit="marines">
                          Upgrades
                          <span class="kuf-unit-upgrade-count" id="kuf-marines-upgrade-count">0</span>
                        </button>
                      </div>
                      <div class="kuf-sim-unit-upgrades" id="kuf-marines-upgrades" hidden>
                        <div class="kuf-upgrade-option">
                          <span class="kuf-upgrade-name">Health</span>
                          <div class="kuf-upgrade-controls">
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-minus" type="button" data-unit="marines" data-stat="health">−</button>
                            <span class="kuf-upgrade-value" id="kuf-marines-health-upgrade">0</span>
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-plus" type="button" data-unit="marines" data-stat="health">+</button>
                          </div>
                        </div>
                        <div class="kuf-upgrade-option">
                          <span class="kuf-upgrade-name">Attack</span>
                          <div class="kuf-upgrade-controls">
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-minus" type="button" data-unit="marines" data-stat="attack">−</button>
                            <span class="kuf-upgrade-value" id="kuf-marines-attack-upgrade">0</span>
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-plus" type="button" data-unit="marines" data-stat="attack">+</button>
                          </div>
                        </div>
                        <div class="kuf-upgrade-option">
                          <span class="kuf-upgrade-name">Attack Speed</span>
                          <div class="kuf-upgrade-controls">
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-minus" type="button" data-unit="marines" data-stat="attackSpeed">−</button>
                            <span class="kuf-upgrade-value" id="kuf-marines-speed-upgrade">0</span>
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-plus" type="button" data-unit="marines" data-stat="attackSpeed">+</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Sniper -->
                    <div class="kuf-sim-unit">
                      <div class="kuf-sim-unit-header">
                        <span class="kuf-sim-unit-name">Sniper</span>
                        <div class="kuf-sim-unit-count-controls">
                          <button class="kuf-unit-btn kuf-unit-btn-minus" type="button" data-unit="snipers" data-action="minus">−</button>
                          <span class="kuf-sim-unit-count" id="kuf-snipers-count">0</span>
                          <button class="kuf-unit-btn kuf-unit-btn-plus" type="button" data-unit="snipers" data-action="plus">+</button>
                        </div>
                        <div class="kuf-sim-unit-cost">
                          <span class="kuf-sim-unit-cost-each">15</span> ea.
                          (<span id="kuf-snipers-total-cost">0</span>)
                        </div>
                        <button class="kuf-unit-upgrade-btn" type="button" data-unit="snipers">
                          Upgrades
                          <span class="kuf-unit-upgrade-count" id="kuf-snipers-upgrade-count">0</span>
                        </button>
                      </div>
                      <div class="kuf-sim-unit-upgrades" id="kuf-snipers-upgrades" hidden>
                        <div class="kuf-upgrade-option">
                          <span class="kuf-upgrade-name">Health</span>
                          <div class="kuf-upgrade-controls">
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-minus" type="button" data-unit="snipers" data-stat="health">−</button>
                            <span class="kuf-upgrade-value" id="kuf-snipers-health-upgrade">0</span>
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-plus" type="button" data-unit="snipers" data-stat="health">+</button>
                          </div>
                        </div>
                        <div class="kuf-upgrade-option">
                          <span class="kuf-upgrade-name">Attack</span>
                          <div class="kuf-upgrade-controls">
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-minus" type="button" data-unit="snipers" data-stat="attack">−</button>
                            <span class="kuf-upgrade-value" id="kuf-snipers-attack-upgrade">0</span>
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-plus" type="button" data-unit="snipers" data-stat="attack">+</button>
                          </div>
                        </div>
                        <div class="kuf-upgrade-option">
                          <span class="kuf-upgrade-name">Attack Speed</span>
                          <div class="kuf-upgrade-controls">
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-minus" type="button" data-unit="snipers" data-stat="attackSpeed">−</button>
                            <span class="kuf-upgrade-value" id="kuf-snipers-speed-upgrade">0</span>
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-plus" type="button" data-unit="snipers" data-stat="attackSpeed">+</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Splayer -->
                    <div class="kuf-sim-unit">
                      <div class="kuf-sim-unit-header">
                        <span class="kuf-sim-unit-name">Splayer</span>
                        <div class="kuf-sim-unit-count-controls">
                          <button class="kuf-unit-btn kuf-unit-btn-minus" type="button" data-unit="splayers" data-action="minus">−</button>
                          <span class="kuf-sim-unit-count" id="kuf-splayers-count">0</span>
                          <button class="kuf-unit-btn kuf-unit-btn-plus" type="button" data-unit="splayers" data-action="plus">+</button>
                        </div>
                        <div class="kuf-sim-unit-cost">
                          <span class="kuf-sim-unit-cost-each">30</span> ea.
                          (<span id="kuf-splayers-total-cost">0</span>)
                        </div>
                        <button class="kuf-unit-upgrade-btn" type="button" data-unit="splayers">
                          Upgrades
                          <span class="kuf-unit-upgrade-count" id="kuf-splayers-upgrade-count">0</span>
                        </button>
                      </div>
                      <div class="kuf-sim-unit-upgrades" id="kuf-splayers-upgrades" hidden>
                        <div class="kuf-upgrade-option">
                          <span class="kuf-upgrade-name">Health</span>
                          <div class="kuf-upgrade-controls">
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-minus" type="button" data-unit="splayers" data-stat="health">−</button>
                            <span class="kuf-upgrade-value" id="kuf-splayers-health-upgrade">0</span>
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-plus" type="button" data-unit="splayers" data-stat="health">+</button>
                          </div>
                        </div>
                        <div class="kuf-upgrade-option">
                          <span class="kuf-upgrade-name">Attack</span>
                          <div class="kuf-upgrade-controls">
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-minus" type="button" data-unit="splayers" data-stat="attack">−</button>
                            <span class="kuf-upgrade-value" id="kuf-splayers-attack-upgrade">0</span>
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-plus" type="button" data-unit="splayers" data-stat="attack">+</button>
                          </div>
                        </div>
                        <div class="kuf-upgrade-option">
                          <span class="kuf-upgrade-name">Attack Speed</span>
                          <div class="kuf-upgrade-controls">
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-minus" type="button" data-unit="splayers" data-stat="attackSpeed">−</button>
                            <span class="kuf-upgrade-value" id="kuf-splayers-speed-upgrade">0</span>
                            <button class="kuf-upgrade-btn kuf-upgrade-btn-plus" type="button" data-unit="splayers" data-stat="attackSpeed">+</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div class="kuf-result-panel" id="kuf-result-panel" hidden>
                  <h4>Simulation Complete</h4>
                  <p id="kuf-result-summary">Awaiting results.</p>
                  <p id="kuf-result-glyphs">Surpass your high score to earn more glyphs.</p>
                  <button class="action-button ghost" type="button" id="kuf-result-close">Close</button>
                </div>
              </div>
            </article>

            <!-- Shard Ledger below simulation -->
            <article class="card kuf-card kuf-card--ledger" id="kuf-ledger-card">
              <h3 class="kuf-card-title">Shard Ledger</h3>
              <p class="kuf-card-subtitle">Track shard allocation and performance metrics.</p>
              <dl class="kuf-ledger" aria-live="polite">
                <div class="kuf-ledger-row">
                  <dt>Shards</dt>
                  <dd>
                    <span id="kuf-shards-remaining">0</span>
                    <span aria-hidden="true">/</span>
                    <span class="kuf-ledger-total" id="kuf-shards-total">0</span>
                  </dd>
                </div>
                <div class="kuf-ledger-row">
                  <dt>High Score</dt>
                  <dd><span id="kuf-high-score">0</span> gold</dd>
                </div>
                <div class="kuf-ledger-row">
                  <dt>Kuf Glyphs</dt>
                  <dd><span id="kuf-glyph-count">0</span></dd>
                </div>
                <div class="kuf-ledger-row">
                  <dt>Last Run</dt>
                  <dd id="kuf-last-result">Awaiting first simulation.</dd>
                </div>
              </dl>
              <p class="kuf-ledger-note">Earn new Kuf glyphs only by surpassing your best gold haul.</p>
            </article>

            <!-- Shard Codex - new section -->
            <article class="card kuf-card kuf-card--codex" id="kuf-codex-card">
              <h3 class="kuf-card-title">Shard Codex</h3>
              <p class="kuf-card-subtitle">Unit records and encountered adversaries.</p>
              
              <div class="kuf-codex-section">
                <h4 class="kuf-codex-section-title">Your Units</h4>
                <div class="kuf-codex-unit" id="kuf-codex-marines">
                  <div class="kuf-codex-unit-header">
                    <span class="kuf-codex-unit-name">Marine</span>
                    <span class="kuf-codex-unit-count">Count: <span id="kuf-codex-marines-count">0</span></span>
                  </div>
                  <dl class="kuf-codex-stats">
                    <div class="kuf-codex-stat-row">
                      <dt>Health</dt>
                      <dd id="kuf-codex-marines-health">10 HP</dd>
                    </div>
                    <div class="kuf-codex-stat-row">
                      <dt>Attack</dt>
                      <dd id="kuf-codex-marines-attack">1.0 Damage</dd>
                    </div>
                    <div class="kuf-codex-stat-row">
                      <dt>Attack Speed</dt>
                      <dd id="kuf-codex-marines-speed">1.00 /s</dd>
                    </div>
                  </dl>
                </div>
                
                <div class="kuf-codex-unit" id="kuf-codex-snipers">
                  <div class="kuf-codex-unit-header">
                    <span class="kuf-codex-unit-name">Sniper</span>
                    <span class="kuf-codex-unit-count">Count: <span id="kuf-codex-snipers-count">0</span></span>
                  </div>
                  <dl class="kuf-codex-stats">
                    <div class="kuf-codex-stat-row">
                      <dt>Health</dt>
                      <dd id="kuf-codex-snipers-health">8 HP</dd>
                    </div>
                    <div class="kuf-codex-stat-row">
                      <dt>Attack</dt>
                      <dd id="kuf-codex-snipers-attack">2.0 Damage</dd>
                    </div>
                    <div class="kuf-codex-stat-row">
                      <dt>Attack Speed</dt>
                      <dd id="kuf-codex-snipers-speed">0.50 /s</dd>
                    </div>
                  </dl>
                </div>
                
                <div class="kuf-codex-unit" id="kuf-codex-splayers">
                  <div class="kuf-codex-unit-header">
                    <span class="kuf-codex-unit-name">Splayer</span>
                    <span class="kuf-codex-unit-count">Count: <span id="kuf-codex-splayers-count">0</span></span>
                  </div>
                  <dl class="kuf-codex-stats">
                    <div class="kuf-codex-stat-row">
                      <dt>Health</dt>
                      <dd id="kuf-codex-splayers-health">12 HP</dd>
                    </div>
                    <div class="kuf-codex-stat-row">
                      <dt>Attack</dt>
                      <dd id="kuf-codex-splayers-attack">0.8 Damage</dd>
                    </div>
                    <div class="kuf-codex-stat-row">
                      <dt>Attack Speed</dt>
                      <dd id="kuf-codex-splayers-speed">0.70 /s</dd>
                    </div>
                  </dl>
                </div>
              </div>
              
              <div class="kuf-codex-section">
                <h4 class="kuf-codex-section-title">Encountered Enemies</h4>
                <div id="kuf-codex-enemies">
                  <p class="kuf-codex-empty">Complete a simulation to log enemy encounters.</p>
                </div>
              </div>
            </article>
          </div>

          <section class="panel-grid spire-options-grid" aria-label="Kuf Spire options">
            <article class="card spire-options-card">
              <button
                class="action-button spire-options-trigger"
                type="button"
                id="kuf-options-toggle-button"
                aria-expanded="false"
                aria-controls="kuf-options-menu"
              >
                <span class="spire-options-glyph" aria-hidden="true">ק</span>
                <span>Spire Options</span>
              </button>
              <div
                class="spire-options-menu"
                id="kuf-options-menu"
                data-open="false"
                aria-hidden="true"
                hidden
              >
                <button class="action-button ghost" type="button" id="kuf-effects-level-button">Effects · Auto</button>
                <div class="settings-toggle" id="kuf-glow-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="kuf-glow-title">Glow Overlays</span>
                    <span class="settings-toggle-description" id="kuf-glow-description"
                      >Disable trail glows and bloom to improve performance on slower devices.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="kuf-glow-toggle">
                    <input
                      type="checkbox"
                      id="kuf-glow-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="kuf-glow-title"
                      aria-describedby="kuf-glow-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="kuf-glow-toggle-state">On</span>
                  </label>
                </div>
                <button class="action-button ghost spire-options-close" type="button">Close</button>
              </div>
            </article>
          </section>


        </section>

        <section
          class="panel"
          data-panel="achievements"
          id="panel-achievements"
          role="tabpanel"
          aria-labelledby="tab-achievements"
          hidden
        >
          <header class="panel-header">Achievements Terrarium</header>
          <p class="achievement-note">
            Each sealed proof adds <strong>+1 mote per minute</strong> to the idle bank and grants terrarium creatures and items.
          </p>
          
          <!-- Terrarium rendering section moved from Bet Spire -->
          <section class="fluid-grid" aria-label="Achievements Terrarium">
            <div class="fluid-simulation-slot" id="achievements-terrarium-host">
              <article class="card powder-simulation fluid-simulation-card" id="achievements-terrarium-card">
                <div class="powder-basin fluid-basin" id="achievements-terrarium-basin">
                  <canvas
                    id="achievements-terrarium-canvas"
                    class="fluid-canvas"
                    width="240"
                    height="320"
                    role="presentation"
                    aria-hidden="true"
                  ></canvas>
                  <div class="fluid-terrarium-layer" id="achievements-terrarium-layer">
                    <div
                      class="fluid-terrarium-stage"
                      id="achievements-terrarium-stage"
                      role="img"
                      aria-label="Achievement terrarium with creatures and items"
                    >
                      <div class="fluid-terrarium-stage__media" id="achievements-terrarium-stage-media">
                        <div class="fluid-terrarium__sky" id="achievements-terrarium-sky" aria-hidden="true">
                          <div class="fluid-terrarium__sun" id="achievements-terrarium-sun" aria-hidden="true"></div>
                          <div class="fluid-terrarium__moon" id="achievements-terrarium-moon" aria-hidden="true"></div>
                          <div
                            class="fluid-terrarium__stars fluid-terrarium__stars--near"
                            id="achievements-terrarium-stars-near"
                          ></div>
                          <div
                            class="fluid-terrarium__stars fluid-terrarium__stars--far"
                            id="achievements-terrarium-stars-far"
                          ></div>
                        </div>
                        <img
                          class="fluid-terrarium__background"
                          src="./assets/sprites/spires/betSpire/Cave-Background.svg"
                          alt=""
                          loading="lazy"
                          decoding="async"
                          aria-hidden="true"
                        />
                        <img
                          class="fluid-terrarium__magma"
                          src="./assets/sprites/spires/betSpire/Magma.png"
                          alt=""
                          loading="lazy"
                          decoding="async"
                          aria-hidden="true"
                        />
                        <div class="fluid-terrarium__magma-glow" aria-hidden="true"></div>
                        <img
                          class="fluid-terrarium__floating-island"
                          id="achievements-terrarium-floating-island"
                          src="./assets/sprites/spires/betSpire/Floating-Island.png"
                          alt=""
                          loading="lazy"
                          decoding="async"
                          aria-hidden="true"
                        />
                        <img
                          class="fluid-terrarium__collision-map"
                          id="achievements-terrarium-floating-island-collision"
                          src="./assets/sprites/spires/betSpire/Floating-Island.svg"
                          alt=""
                          loading="lazy"
                          decoding="async"
                          aria-hidden="true"
                        />
                        <img
                          class="fluid-terrarium__foreground fluid-terrarium__terrain"
                          id="achievements-terrarium-foreground"
                          src="./assets/sprites/spires/betSpire/Terrain.svg"
                          alt=""
                          loading="lazy"
                          decoding="async"
                          aria-hidden="true"
                        />
                        <img
                          class="fluid-terrarium__collision-map"
                          id="achievements-terrarium-foreground-collision"
                          src="./assets/sprites/spires/betSpire/Terrain.svg"
                          alt=""
                          loading="lazy"
                          decoding="async"
                          aria-hidden="true"
                        />
                      </div>
                    </div>
                  <div class="powder-viewport fluid-viewport" id="achievements-terrarium-viewport"></div>
                </div>
              </div>
              </article>
            </div>
            
            <!-- Terrarium Items dropdown -->
            <article class="card fluid-terrarium-items-card">
              <button
                class="fluid-terrarium-items-toggle"
                type="button"
                id="achievements-terrarium-items-toggle"
                aria-expanded="false"
                aria-controls="achievements-terrarium-items-dropdown"
              >
                <span class="fluid-terrarium-items-toggle__title">Terrarium Items</span>
                <span class="fluid-terrarium-items-toggle__chevron" aria-hidden="true">▼</span>
              </button>
              <div
                class="fluid-terrarium-items-dropdown"
                id="achievements-terrarium-items-dropdown"
                data-open="false"
                aria-hidden="true"
                hidden
              >
                <p class="fluid-terrarium-items-empty" id="achievements-terrarium-items-empty">Celestial bodies (sun & moon) appear here. Other items (creatures, trees, shrooms) are added to the Bet Spire terrarium.</p>
                <ul class="fluid-terrarium-items-list" id="achievements-terrarium-items-list" aria-label="Terrarium items list"></ul>
              </div>
            </article>
          </section>
          
          <div class="achievement-grid" id="achievement-grid" role="list"></div>
        </section>

        <section
          class="panel"
          data-panel="options"
          id="panel-options"
          role="tabpanel"
          aria-labelledby="tab-options"
          hidden
        >
          <header class="panel-header">Options &amp; Codex</header>
          <div class="panel-grid">
            <article class="card" id="sound-card">
              <h3 id="sound-card-title">Sound</h3>
              <p>Adjust harmonic resonance levels.</p>
              <div class="slider-group" role="group" aria-labelledby="sound-card-title">
                <div class="slider-row">
                  <div class="slider-row-header">
                    <label class="slider-label" for="music-volume">Music</label>
                    <span class="slider-value" id="music-volume-value">100%</span>
                  </div>
                  <input
                    class="slider-input"
                    type="range"
                    id="music-volume"
                    min="0"
                    max="100"
                    step="1"
                    value="100"
                    aria-label="Music volume"
                  />
                </div>
                <div class="slider-row">
                  <div class="slider-row-header">
                    <label class="slider-label" for="sfx-volume">Sound Effects</label>
                    <span class="slider-value" id="sfx-volume-value">100%</span>
                  </div>
                  <input
                    class="slider-input"
                    type="range"
                    id="sfx-volume"
                    min="0"
                    max="100"
                    step="1"
                    value="100"
                    aria-label="Sound effects volume"
                  />
                </div>
              </div>
            </article>
            <article class="card visual-settings-card">
              <div class="visual-settings-copy">
                <h3>Visual Settings</h3>
                <p>Fine-tune palettes, notation, and battlefield overlays.</p>
              </div>
              <button
                class="action-button visual-settings-trigger"
                type="button"
                id="visual-settings-menu-button"
                aria-expanded="false"
                aria-controls="visual-settings-menu"
              >
                Visual Settings
              </button>
              <div
                class="visual-settings-menu"
                id="visual-settings-menu"
                data-open="false"
                aria-hidden="true"
                hidden
              >
                <button class="action-button ghost" type="button" id="color-scheme-button">
                  Palette · Aurora
                </button>
                <div class="palette-gradient-preview" id="color-scheme-gradient-preview" aria-hidden="true"></div>
                <button class="action-button ghost" type="button" id="track-graphics-button">
                  Track · Gradient
                </button>
                <!-- Inline preview mirrors the active track render mode and tracer toggle. -->
                <div class="track-render-preview" aria-hidden="true">
                  <span class="track-render-preview-label">Track preview</span>
                  <div class="track-render-preview-line" id="track-render-preview-line" data-mode="gradient">
                    <span class="track-render-preview-tracer" id="track-render-preview-tracer"></span>
                  </div>
                </div>
                <div class="settings-toggle" id="track-tracer-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="track-tracer-toggle-title">Track Tracer</span>
                    <span class="settings-toggle-description" id="track-tracer-toggle-description"
                      >Project a luminous tracer along the path; river tracks inherit accelerated sparks from it.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="track-tracer-toggle">
                    <input
                      type="checkbox"
                      id="track-tracer-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="track-tracer-toggle-title"
                      aria-describedby="track-tracer-toggle-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="track-tracer-toggle-state">On</span>
                  </label>
                </div>
                <button class="action-button ghost" type="button" id="notation-toggle-button">
                  Notation · Letters
                </button>
                <!-- Preview how floating enemy damage values will render under the active notation. -->
                <div class="notation-preview" id="notation-preview" aria-live="polite">
                  <span class="notation-preview-label">Enemy damage sample</span>
                  <span class="notation-preview-value" id="notation-preview-value">5.10 quadrillion dmg</span>
                </div>
                <!-- Toggle between low and high graphics fidelity. -->
                <button class="action-button ghost" type="button" id="graphics-mode-button">
                  Graphics · High
                </button>
                <!-- Toggle to reveal glyph equations inside tower upgrade cards. -->
                <div class="settings-toggle" id="glyph-equation-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title">Show Glyph Equations</span>
                    <span class="settings-toggle-description"
                      >Reveal Aleph glyph formulas within every tower detail.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="glyph-equation-toggle">
                    <input
                      type="checkbox"
                      id="glyph-equation-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-checked="false"
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="glyph-equation-toggle-state">Off</span>
                  </label>
                </div>
                <div class="settings-toggle" id="damage-number-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title">Floating Damage Numbers</span>
                    <span class="settings-toggle-description"
                      >Show colorful combat values drifting away from struck glyphs.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="damage-number-toggle">
                    <input
                      type="checkbox"
                      id="damage-number-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="damage-number-toggle-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="wave-kill-tally-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="wave-kill-tally-title">Wave Kill Tallies</span>
                    <span class="settings-toggle-description" id="wave-kill-tally-description"
                      >Scribble each lattice's kill count above the tower when a wave ends.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="wave-kill-tally-toggle">
                    <input
                      type="checkbox"
                      id="wave-kill-tally-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="wave-kill-tally-title"
                      aria-describedby="wave-kill-tally-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="wave-kill-tally-toggle-state">On</span>
                  </label>
                </div>
                <div class="settings-toggle" id="wave-damage-tally-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="wave-damage-tally-title">Wave Damage Tallies</span>
                    <span class="settings-toggle-description" id="wave-damage-tally-description"
                      >Fade each tower's total damage beneath the lattice during the intermission.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="wave-damage-tally-toggle">
                    <input
                      type="checkbox"
                      id="wave-damage-tally-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="wave-damage-tally-title"
                      aria-describedby="wave-damage-tally-description"
                      aria-checked="true"
                      checked
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="wave-damage-tally-toggle-state">On</span>
                  </label>
                </div>
                <!-- Frame rate limit slider for older devices. -->
                <div class="slider-row visual-settings-slider-row" id="frame-rate-limit-row">
                  <div class="slider-row-header">
                    <label class="slider-label" for="frame-rate-limit" id="frame-rate-limit-label">Frame Rate Limit</label>
                    <span class="slider-value" id="frame-rate-limit-value">60 fps</span>
                  </div>
                  <input
                    class="slider-input"
                    type="range"
                    id="frame-rate-limit"
                    min="30"
                    max="120"
                    step="5"
                    value="60"
                    aria-labelledby="frame-rate-limit-label"
                    aria-describedby="frame-rate-limit-description"
                  />
                  <span class="slider-description" id="frame-rate-limit-description"
                    >Lower values may improve performance on older devices.</span
                  >
                </div>
                <!-- Toggle to show FPS counter in top-left corner. -->
                <div class="settings-toggle" id="fps-counter-toggle-row">
                  <div class="settings-toggle-text">
                    <span class="settings-toggle-title" id="fps-counter-title">FPS Counter</span>
                    <span class="settings-toggle-description" id="fps-counter-description"
                      >Display current frames per second in the top-left corner.</span
                    >
                  </div>
                  <label class="settings-toggle-control" for="fps-counter-toggle">
                    <input
                      type="checkbox"
                      id="fps-counter-toggle"
                      class="settings-toggle-input"
                      role="switch"
                      aria-labelledby="fps-counter-title"
                      aria-describedby="fps-counter-description"
                      aria-checked="false"
                    />
                    <span class="settings-toggle-slider" aria-hidden="true"></span>
                    <span class="settings-toggle-state" id="fps-counter-toggle-state">Off</span>
                  </label>
                </div>
              </div>
            </article>
            <article class="card loadout-slots-card">
              <div class="loadout-slots-copy">
                <h3>Loadout Slots</h3>
                <p>Choose how many glyphs to keep ready. Long-press a loadout slot to swap towers mid-defense.</p>
              </div>
              <button
                class="action-button ghost"
                type="button"
                id="loadout-slot-button"
                aria-live="polite"
                aria-label="Cycle loadout slots"
              >
                Slots · 2
              </button>
            </article>
            <article class="card">
              <h3>Field Notes</h3>
              <p>Consult the archivist for a briefing on the current storyline.</p>
              <button class="action-button ghost" type="button" id="open-codex-button">
                Field Notes
              </button>
            </article>
            <article class="card">
              <h3>Enemy Codex</h3>
              <p>Review encountered enemy types and their combat characteristics.</p>
              <button class="action-button ghost" type="button" id="open-enemy-codex-button">
                Enemy Codex
              </button>
            </article>
          </div>
          <section class="level-legend codex-roadmap" aria-labelledby="codex-proof-roadmap-title">
            <header class="codex-header">
              <span class="codex-label">Codex</span>
              <h3 id="codex-proof-roadmap-title">Proof Roadmap</h3>
            </header>
            <ul class="set-timeline">
              <li class="set-card active-set">
                <h4>Conjecture Levels 1-5</h4>
                <p>Speculative math under siege. Examples highlight famous unsolved ideas.</p>
              </li>
              <li class="set-card">
                <h4>Corollary Levels 6-10</h4>
                <p>Statements that immediately bloom from the conjecture victories.</p>
              </li>
              <li class="set-card">
                <h4>Lemma Levels 11-15</h4>
                <p>Utility proofs and support tactics that bolster the main argument.</p>
              </li>
              <li class="set-card">
                <h4>Proposition Levels 16-20</h4>
                <p>Solid but modest claims—expect compound paths and multi-route assaults.</p>
              </li>
              <li class="set-card">
                <h4>Theorem Levels 21-25</h4>
                <p>Major revelations guarded by elite enemy archetypes.</p>
              </li>
              <li class="set-card">
                <h4>Axiom Levels 26-30</h4>
                <p>Foundational truths; everything loops back to primal glyph geometry.</p>
              </li>
            </ul>
          </section>
          <article class="card powder-log-card codex-lab-chronicle">
            <h3>Lab Chronicle</h3>
            <p class="powder-footnote">Recent experiments echo here for quick review.</p>
            <ul class="powder-log" id="powder-log" aria-live="polite" aria-label="Recent mote experiments"></ul>
            <p class="powder-log-empty" id="powder-log-empty">No experiments recorded yet.</p>
          </article>
          <article class="card performance-log-card" id="performance-codex-card">
            <div class="performance-log-header">
              <h3>Spire Diagnostics</h3>
              <p class="performance-log-updated" id="performance-log-updated">Awaiting diagnostics…</p>
            </div>
            <p class="performance-log-description">
              Real-time samples measure the frame cost of the playfield, rendering, and the busiest spires.
            </p>
            <div class="performance-log-list" id="performance-log-list" hidden></div>
            <p class="performance-log-empty" id="performance-log-empty">
              Enter a battle to populate performance samples.
            </p>
          </article>
          <section class="enemy-codex" id="enemy-codex-section" aria-live="polite" tabindex="-1" hidden>
            <header class="subsection-title">Enemy Codex</header>
            <div class="codex-controls">
              <button class="action-button ghost" type="button" id="codex-options-button">
                Open Options
              </button>
              <label class="developer-mode-toggle" for="codex-developer-mode">
                <input type="checkbox" id="codex-developer-mode" />
                Developer Mode — unlock all towers, levels, and entries
              </label>
              <button class="developer-reset-button" type="button" id="developer-reset-button">
                Delete Player Data
              </button>
              <p class="developer-mode-note" id="codex-developer-note" hidden>
                Developer mode active: all content is unlocked for rapid iteration.
              </p>
              <div class="developer-control-panel" id="developer-control-panel" hidden aria-hidden="true">
                <div class="developer-control-field developer-control-field--checkbox">
                  <label for="developer-infinite-thero">
                    <input
                      type="checkbox"
                      id="developer-infinite-thero"
                      data-developer-toggle="infiniteThero"
                    />
                    Infinite þ
                  </label>
                  <p class="developer-control-hint">
                    Start every defense with limitless Thero for sandbox testing.
                  </p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-mote-bank">Idle mote bank</label>
                  <input
                    type="number"
                    id="developer-mote-bank"
                    data-developer-field="moteBank"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Override the stored mote reserve.</p>
                </div>
                <!-- Compact basin autosave removed per task 24 - it is now the only save method -->
                <div class="developer-control-field">
                  <label for="developer-mote-rate">Mote fall rate</label>
                  <input
                    type="number"
                    id="developer-mote-rate"
                    data-developer-field="moteRate"
                    min="0"
                    step="0.01"
                    inputmode="decimal"
                  />
                  <p class="developer-control-hint">Set motes dispensed per second.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-lamed-bank">Lamed spark bank</label>
                  <input
                    type="number"
                    id="developer-lamed-bank"
                    data-developer-field="lamedBank"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Override the Lamed spire spark reserve.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-lamed-rate">Lamed spark rate</label>
                  <input
                    type="number"
                    id="developer-lamed-rate"
                    data-developer-field="lamedRate"
                    min="0"
                    step="0.01"
                    inputmode="decimal"
                  />
                  <p class="developer-control-hint">Set sparks dispensed per second.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-tsadi-bank">Tsadi particle bank</label>
                  <input
                    type="number"
                    id="developer-tsadi-bank"
                    data-developer-field="tsadiBank"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Override the Tsadi spire particle reserve.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-tsadi-rate">Tsadi particle rate</label>
                  <input
                    type="number"
                    id="developer-tsadi-rate"
                    data-developer-field="tsadiRate"
                    min="0"
                    step="0.01"
                    inputmode="decimal"
                  />
                  <p class="developer-control-hint">Set particles dispensed per second.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-start-thero">Base start þ</label>
                  <input
                    type="number"
                    id="developer-start-thero"
                    data-developer-field="startThero"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Adjust starting Thero before multipliers.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-thero-multiplier">Thero multiplier</label>
                  <input
                    type="number"
                    id="developer-thero-multiplier"
                    data-developer-field="theroMultiplier"
                    min="0"
                    step="0.01"
                    inputmode="decimal"
                  />
                  <p class="developer-control-hint">
                    Override the starting Thero multiplier. Leave blank to follow progression.
                  </p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-glyphs-aleph">Aleph glyphs</label>
                  <input
                    type="number"
                    id="developer-glyphs-aleph"
                    data-developer-field="glyphsAleph"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Override Aleph glyphs earned and currency.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-glyphs-bet">Bet glyphs</label>
                  <input
                    type="number"
                    id="developer-glyphs-bet"
                    data-developer-field="glyphsBet"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Set Bet glyphs earned from the Bet Spire Terrarium.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-glyphs-lamed">Lamed glyphs</label>
                  <input
                    type="number"
                    id="developer-glyphs-lamed"
                    data-developer-field="glyphsLamed"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Manually set Lamed spark glyph conversions.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-glyphs-tsadi">Tsadi glyphs</label>
                  <input
                    type="number"
                    id="developer-glyphs-tsadi"
                    data-developer-field="glyphsTsadi"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Override Tsadi fusion glyph totals.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-glyphs-shin">Shin glyphs</label>
                  <input
                    type="number"
                    id="developer-glyphs-shin"
                    data-developer-field="glyphsShin"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Set glyphs granted by fractal completions.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-glyphs-kuf">Kuf glyphs</label>
                  <input
                    type="number"
                    id="developer-glyphs-kuf"
                    data-developer-field="glyphsKuf"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Manually set Kuf glyph earnings from tactics.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-bet-drop-rate">Bet Spire Serendipity rate</label>
                  <input
                    type="number"
                    id="developer-bet-drop-rate"
                    data-developer-field="betDropRate"
                    min="0"
                    step="0.01"
                    inputmode="decimal"
                  />
                  <p class="developer-control-hint">Set Serendipity per second for Bet Spire.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-bet-bank">Bet Spire Serendipity reserve</label>
                  <input
                    type="number"
                    id="developer-bet-bank"
                    data-developer-field="betDropBank"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Override the stored Serendipity reserve for Bet Spire.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-iteron-bank">Shin Spire iteron bank</label>
                  <input
                    type="number"
                    id="developer-iteron-bank"
                    data-developer-field="iteronBank"
                    min="0"
                    step="1"
                    inputmode="numeric"
                  />
                  <p class="developer-control-hint">Override the stored iteron reserve for Shin Spire.</p>
                </div>
                <div class="developer-control-field">
                  <label for="developer-iteration-rate">Shin Spire iteration rate</label>
                  <input
                    type="number"
                    id="developer-iteration-rate"
                    data-developer-field="iterationRate"
                    min="0"
                    step="0.1"
                    inputmode="decimal"
                  />
                  <p class="developer-control-hint">Set Equivalence allocated per second for Shin Spire.</p>
                </div>
              </div>
            </div>
          </section>
        </section>
      </main>

      <nav class="tab-bar" aria-label="Primary" role="tablist">
        <button
          class="tab-button active"
          data-tab="tower"
          id="tab-tower"
          type="button"
          role="tab"
          aria-label="Defense"
          aria-controls="panel-tower"
          aria-selected="true"
          aria-pressed="true"
        >
          <span class="tab-icon">℘</span>
          <span class="tab-label">Defense</span>
        </button>
        <button
          class="tab-button"
          data-tab="towers"
          id="tab-towers"
          type="button"
          role="tab"
          aria-label="Towers"
          aria-controls="panel-towers"
          aria-selected="false"
          aria-pressed="false"
        >
          <span class="tab-icon">α</span>
          <span class="tab-label">Towers</span>
          <!-- Indicator for unused glyph currency relocated beneath the tab title. -->
          <span class="tab-icon-badge tab-icon-badge--glyphs" id="tab-glyph-badge" hidden>0</span>
        </button>
        <!-- Multiple compact spire tabs stacked together in middle slot -->
        <div class="tab-button-stack spire-tab-stack" id="spire-tab-stack">
          <button
            class="tab-button tab-button--stacked tab-button--stacked-aleph"
            data-tab="powder"
            id="tab-powder"
            type="button"
            role="tab"
            aria-label="Aleph Spire"
            aria-controls="panel-powder"
            aria-selected="false"
            aria-pressed="false"
          >
            <span class="tab-icon">ℵ</span>
          </button>
          <button
            class="tab-button tab-button--stacked tab-button--stacked-bet"
            data-tab="fluid"
            id="tab-fluid"
            type="button"
            role="tab"
            aria-label="Bet Spire"
            aria-controls="panel-fluid"
            aria-selected="false"
            aria-pressed="false"
            hidden
          >
            <span class="tab-icon">בּ</span>
          </button>
          <button
            class="tab-button tab-button--stacked tab-button--stacked-lamed"
            data-tab="lamed"
            id="tab-lamed"
            type="button"
            role="tab"
            aria-label="Lamed Spire"
            aria-controls="panel-lamed"
            aria-selected="false"
            aria-pressed="false"
            hidden
          >
            <span class="tab-icon">ל</span>
          </button>
          <button
            class="tab-button tab-button--stacked tab-button--stacked-tsadi"
            data-tab="tsadi"
            id="tab-tsadi"
            type="button"
            role="tab"
            aria-label="Tsadi Spire"
            aria-controls="panel-tsadi"
            aria-selected="false"
            aria-pressed="false"
            hidden
          >
            <span class="tab-icon">צ</span>
          </button>
          <button
            class="tab-button tab-button--stacked tab-button--stacked-shin"
            data-tab="shin"
            id="tab-shin"
            type="button"
            role="tab"
            aria-label="Shin Spire"
            aria-controls="panel-shin"
            aria-selected="false"
            aria-pressed="false"
            hidden
          >
            <span class="tab-icon">ש</span>
          </button>
          <button
            class="tab-button tab-button--stacked tab-button--stacked-kuf"
            data-tab="kuf"
            id="tab-kuf"
            type="button"
            role="tab"
            aria-label="Kuf Spire"
            aria-controls="panel-kuf"
            aria-selected="false"
            aria-pressed="false"
            hidden
          >
            <span class="tab-icon">ק</span>
          </button>
        </div>
        <button
          class="tab-button"
          data-tab="achievements"
          id="tab-achievements"
          type="button"
          role="tab"
          aria-label="Achievements"
          aria-controls="panel-achievements"
          aria-selected="false"
          aria-pressed="false"
        >
          <span class="tab-icon">∮</span>
          <span class="tab-label">Proofs</span>
        </button>
        <button
          class="tab-button"
          data-tab="options"
          id="tab-options"
          type="button"
          role="tab"
          aria-label="Options"
          aria-controls="panel-options"
          aria-selected="false"
          aria-pressed="false"
        >
          <span class="tab-icon">
          <span class="tab-icon">⧖</span>
          </span>
          <span class="tab-label">Codex</span>
        </button>
      </nav>
    </div>
    <div
      class="level-overlay variable-library-overlay"
      id="variable-library-overlay"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      hidden
      aria-labelledby="variable-library-title"
    >
      <div class="overlay-panel">
        <button
          class="overlay-close"
          type="button"
          data-variable-library-close
          aria-label="Close variable glossary"
        >
          &times;
        </button>
        <p class="overlay-label">Glyph Variables</p>
        <h2 class="overlay-title" id="variable-library-title">Variable Glossary</h2>
        <p class="overlay-example">
          Review every symbol unlocked across your towers and spectral cohorts.
        </p>
        <ul class="variable-library-list" id="variable-library-list" role="list"></ul>
        <p class="overlay-instruction">Tap outside or press Esc to close.</p>
      </div>
    </div>
    <div
      class="level-overlay upgrade-overlay"
      id="upgrade-matrix-overlay"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      hidden
      aria-labelledby="upgrade-matrix-title"
    >
      <div class="overlay-panel">
        <button
          class="overlay-close"
          type="button"
          data-overlay-close
          aria-label="Close upgrade matrix"
        >
          &times;
        </button>
        <p class="overlay-label">Merge Reference</p>
        <h2 class="overlay-title" id="upgrade-matrix-title">Upgrade Matrix</h2>
        <p class="overlay-example">
          Review how glyph towers ascend, their base lattice costs, and the form unlocked by each merge.
        </p>
        <div class="upgrade-matrix-grid" id="upgrade-matrix-grid" role="list"></div>
        <p class="overlay-instruction">Tap outside or press Esc to close.</p>
      </div>
    </div>
    <div
      class="level-overlay tower-upgrade-overlay"
      id="tower-upgrade-overlay"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      hidden
      aria-labelledby="tower-upgrade-title"
    >
      <div class="overlay-panel tower-upgrade-panel">
        <button
          class="overlay-close"
          type="button"
          data-tower-upgrade-close
          aria-label="Close tower upgrade menu"
        >
          &times;
        </button>
        <p class="overlay-label">Glyph Variable Lattice</p>
        <div class="tower-upgrade-header">
          <figure class="tower-upgrade-icon" id="tower-upgrade-icon" aria-hidden="true"></figure>
          <div class="tower-upgrade-heading">
            <h2 class="overlay-title" id="tower-upgrade-title">Tower Equation</h2>
            <p class="tower-upgrade-tier" id="tower-upgrade-tier"></p>
            <p class="tower-upgrade-glyphs" id="tower-upgrade-glyphs">Available Glyphs: 0</p>
          </div>
        </div>
        <div class="tower-upgrade-equations">
          <section class="tower-upgrade-equation" aria-labelledby="tower-upgrade-base-label">
            <h3 class="tower-upgrade-equation-label" id="tower-upgrade-base-label">Master Equation</h3>
            <p class="tower-upgrade-formula" id="tower-upgrade-base"></p>
            <p class="tower-upgrade-formula tower-upgrade-formula--values" id="tower-upgrade-base-values"></p>
          </section>
        </div>
        <div class="tower-upgrade-variables" id="tower-upgrade-variables" role="list"></div>
        <p class="tower-upgrade-note" id="tower-upgrade-note"></p>
        <p class="overlay-instruction">Tap outside or press Esc to close.</p>
      </div>
    </div>
    <div
      class="level-overlay field-notes-overlay"
      id="field-notes-overlay"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      tabindex="-1"
      hidden
    >
      <div class="overlay-panel field-notes-panel" role="document" aria-labelledby="field-notes-title">
        <button class="overlay-close" type="button" id="field-notes-close" aria-label="Close field notes">×</button>
        <button
          class="field-notes-back"
          type="button"
          id="field-notes-back"
          aria-label="Back to field notes list"
          hidden
        >
          ←
        </button>
        <figure class="field-notes-figure">
          <img
            src="./assets/sprites/glyph_book_glowing.png"
            alt="A glowing glyph codex radiates swirling sigils."
          />
          <figcaption>Glowing Glyph Codex</figcaption>
        </figure>
        <p class="overlay-label">Field Notes Dispatch</p>
        <h2 class="overlay-title" id="field-notes-title">Field Notes Archive</h2>
        <div class="field-notes-views">
          <div class="field-notes-copy field-notes-view field-notes-list-view" id="field-notes-list-view" aria-live="polite">
            <p class="field-notes-empty" id="field-notes-empty">No story dispatches logged yet.</p>
            <ul class="field-notes-entries" id="field-notes-list" role="list"></ul>
          </div>
          <div class="field-notes-copy field-notes-view" id="field-notes-copy" aria-live="polite">
            <p class="field-notes-loading" aria-live="polite">Loading field notes…</p>
          </div>
        </div>
        <div class="field-notes-pagination" id="field-notes-pagination">
          <button class="field-notes-page-button" type="button" id="field-notes-prev" aria-label="Previous field notes page" disabled>
            ‹
          </button>
          <span class="field-notes-page-indicator" id="field-notes-page-indicator">Page 1 of 5</span>
          <button class="field-notes-page-button" type="button" id="field-notes-next" aria-label="Next field notes page">
            ›
          </button>
        </div>
      </div>
    </div>
    <!-- Crafting overlay mirrors tower pop-ups while outlining gem-driven fabrication stubs. -->
    <div
      class="level-overlay crafting-overlay"
      id="crafting-overlay"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      tabindex="-1"
      hidden
    >
      <div class="overlay-panel crafting-panel" role="document" aria-labelledby="crafting-title">
        <button class="overlay-close" type="button" id="crafting-close" aria-label="Close crafting menu">×</button>
        <p class="overlay-label">Arcane Fabrication</p>
        <h2 class="overlay-title" id="crafting-title">Gemcraft Assembly</h2>
        <p class="crafting-intro">
          Forge amplifiers and pylons by channeling mote gems into latent tower schematics. Recipes below are
          prototypes awaiting balance.
        </p>
        <!-- Display the player's mote gem collection at the top of the equipment menu. -->
        <article class="card powder-gem-inventory-card">
          <h3>Gem collection</h3>
          <ul class="powder-gem-inventory" id="powder-gem-inventory" aria-live="polite"></ul>
          <p class="powder-gem-inventory-empty" id="powder-gem-empty">No mote gems catalogued yet.</p>
        </article>
        <section
          class="crafted-equipment-section"
          id="crafted-equipment-section"
          aria-labelledby="crafted-equipment-title"
        >
          <header class="crafted-equipment-header">
            <h3 class="crafted-equipment-title" id="crafted-equipment-title">Crafted Equipment</h3>
            <p class="crafted-equipment-note">
              Assign relics to towers to reshape their glyph lattice. Selecting a new tower automatically frees the previous socket.
            </p>
          </header>
          <ul
            class="crafted-equipment-list"
            id="crafted-equipment-list"
            role="list"
            aria-live="polite"
            aria-label="Crafted equipment"
          ></ul>
          <p class="crafted-equipment-empty" id="crafted-equipment-empty" aria-hidden="true">
            No equipment forged yet.
          </p>
        </section>
        <ul class="crafting-list" id="crafting-list" role="list"></ul>
        <p class="overlay-instruction">Tap outside or press Esc to close.</p>
      </div>
    </div>

    <div
      class="level-overlay enemy-codex-overlay"
      id="enemy-codex-overlay"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      tabindex="-1"
      hidden
    >
      <div class="overlay-panel enemy-codex-panel" role="document" aria-labelledby="enemy-codex-overlay-title">
        <button class="overlay-close" type="button" id="enemy-codex-overlay-close" aria-label="Close enemy codex">×</button>
        <p class="overlay-label">Enemy Compendium</p>
        <h2 class="overlay-title" id="enemy-codex-overlay-title">Enemy Codex</h2>
        <p class="enemy-codex-overlay-intro" id="enemy-codex-overlay-intro">
          Encountered enemy glyphs and their tactical signatures are cataloged below.
        </p>
        <div class="enemy-codex-overlay-list" id="enemy-codex-overlay-list" role="list">
          <p class="enemy-codex-overlay-empty" id="enemy-codex-overlay-empty">
            Encounter enemies in combat to unlock their entries.
          </p>
        </div>
        <p class="overlay-instruction">Tap outside or press Esc to close.</p>
      </div>
    </div>

    <div class="level-overlay" id="level-overlay" role="dialog" aria-modal="true" aria-hidden="true" hidden>
      <div class="overlay-panel">
        <p class="overlay-label" id="overlay-level"></p>
        <h2 class="overlay-title" id="overlay-title"></h2>
        <p class="overlay-example" id="overlay-example"></p>
        <figure class="overlay-preview" id="overlay-preview" aria-hidden="true" hidden></figure>
        <dl class="overlay-metrics">
          <div>
            <dt>Mode</dt>
            <dd id="overlay-mode">—</dd>
          </div>
          <div>
            <dt>Run Length</dt>
            <dd id="overlay-duration">—</dd>
          </div>
          <div>
            <dt>Starting Thero</dt>
            <dd id="overlay-start-thero">—</dd>
          </div>
          <div>
            <dt>Rewards</dt>
            <dd id="overlay-rewards">—</dd>
          </div>
        </dl>
        <p class="overlay-last" id="overlay-last">No attempts yet.</p>
        <p class="overlay-instruction">Tap or click to enter</p>
        <!-- Dedicated confirmation button so desktop players can enter levels without relying on overlay clicks. -->
        <button type="button" class="overlay-confirm" id="overlay-confirm">Enter Level</button>
      </div>
    </div>
    <script type="module" src="./assets/main.js"></script>
  </body>
</html>
